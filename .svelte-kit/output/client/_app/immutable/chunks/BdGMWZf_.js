import{b as Ne,d as Se,p as Ve,c as He,a as me,s as _e,f as k,j as b,l as Oe,r as m,v as Re,i as v,h as _,w as u,g as d,e as Me,O as Ke,k as V,B as te,t as O,n as fe,L as Qe,A as se,m as j,M as Pe,P as Fe,E as he,H as We,D as qe,u as Ge}from"./D9dWO0Sc.js";const l=Ne({user:{id:"",settings:null,isAuthenticated:!1},content:{nodes:new Map,currentNode:null,searchQuery:"",searchResults:[],isLoading:!1},progress:{completedModules:new Set,currentStreak:0,totalTimeSpent:0,userProgress:new Map},sync:{isOnline:typeof navigator<"u"?navigator.onLine:!0,lastSync:null,pendingChanges:[],isSyncing:!1},ui:{sidebarOpen:!0,currentView:"dashboard",theme:"light",notifications:[],hasErrors:!1,errorCount:0,lastError:null,lastErrorTime:null}});function Zt(){const{nodes:o,searchQuery:e}=l.content;if(!e.trim())return Array.from(o.values());const t=e.toLowerCase();return Array.from(o.values()).filter(r=>r.title.toLowerCase().includes(t)||r.metadata.tags.some(n=>n.toLowerCase().includes(t)))}function $t(){const{completedModules:o,userProgress:e}=l.progress,t=l.content.nodes.size,r=t>0?o.size/t*100:0;let n=0;const s=Array.from(e.values());return s.length>0&&(n=s.reduce((g,p)=>g+(p.score||0),0)/s.length),{totalModules:t,completedModules:o.size,completionRate:r,averageScore:n,currentStreak:l.progress.currentStreak}}const ue={setCurrentNode:o=>{l.content.currentNode=o},addKnowledgeNode:o=>{const e=new Map(l.content.nodes);e.set(o.id,o),l.content.nodes=e},updateKnowledgeNode:(o,e)=>{const t=l.content.nodes.get(o);if(t){const r=new Map(l.content.nodes);r.set(o,{...t,...e}),l.content.nodes=r}},removeKnowledgeNode:o=>{const e=new Map(l.content.nodes);e.delete(o),l.content.nodes=e;const t=new Set(l.progress.completedModules);t.delete(o),l.progress.completedModules=t;const r=new Map(l.progress.userProgress);r.delete(o),l.progress.userProgress=r},setSearchQuery:o=>{l.content.searchQuery=o},setSearchResults:o=>{l.content.searchResults=o},markModuleCompleted:(o,e)=>{const t=new Set(l.progress.completedModules);t.add(o),l.progress.completedModules=t;const r=l.progress.userProgress.get(o),n={userId:l.user.id,moduleId:o,status:"completed",score:e,timeSpent:r?.timeSpent||0,lastAccessed:new Date,attempts:(r?.attempts||0)+1,bookmarked:r?.bookmarked||!1,notes:r?.notes||"",completedAt:new Date},s=new Map(l.progress.userProgress);s.set(o,n),l.progress.userProgress=s},startModule:o=>{const e=l.progress.userProgress.get(o),t={userId:l.user.id,moduleId:o,status:"in-progress",timeSpent:e?.timeSpent||0,lastAccessed:new Date,attempts:e?.attempts||0,bookmarked:e?.bookmarked||!1,notes:e?.notes||"",startedAt:e?.startedAt||new Date},r=new Map(l.progress.userProgress);r.set(o,t),l.progress.userProgress=r},updateTimeSpent:(o,e)=>{const t=l.progress.userProgress.get(o);if(t){const r={...t,timeSpent:t.timeSpent+e,lastAccessed:new Date},n=new Map(l.progress.userProgress);n.set(o,r),l.progress.userProgress=n}},loadUserProgress:o=>{l.progress.userProgress=new Map(o);const e=new Set;for(const[t,r]of o)r.status==="completed"&&e.add(t);l.progress.completedModules=e,l.progress.totalTimeSpent=Array.from(o.values()).reduce((t,r)=>t+r.timeSpent,0)},updateUserProgress:(o,e)=>{const t=l.progress.userProgress.get(o);if(t){const r=new Map(l.progress.userProgress);r.set(o,{...t,...e}),l.progress.userProgress=r}},toggleSidebar:()=>{l.ui.sidebarOpen=!l.ui.sidebarOpen},setCurrentView:o=>{l.ui.currentView=o},addNotification:o=>{const e=crypto.randomUUID();l.ui.notifications.push({...o,id:e,timestamp:new Date})},removeNotification:o=>{const e=l.ui.notifications.findIndex(t=>t.id===o);e>-1&&l.ui.notifications.splice(e,1)},setOnlineStatus:o=>{l.sync.isOnline=o},addPendingChange:o=>{l.sync.pendingChanges.includes(o)||l.sync.pendingChanges.push(o)},removePendingChange:o=>{const e=l.sync.pendingChanges.indexOf(o);e>-1&&l.sync.pendingChanges.splice(e,1)},setSyncStatus:o=>{l.sync.isSyncing=o,o||(l.sync.lastSync=new Date)}};var Xe=(o,e,t)=>e(t().id),Ye=k('<button class="expand-btn svelte-1oods8b"> </button>'),Ze=k('<span class="expand-spacer svelte-1oods8b"></span>'),$e=(o,e,t)=>e(t()),et=k('<span class="completion-badge svelte-1oods8b" title="Completed">✅</span>'),tt=(o,e,t)=>e(t().id,"folder"),st=(o,e,t)=>e(t().id,"module"),rt=k('<button class="action-btn svelte-1oods8b" title="Add Subfolder">📁+</button> <button class="action-btn svelte-1oods8b" title="Add Module">📚+</button>',1),at=(o,e,t)=>e(t().parent||null,"lesson"),nt=k('<button class="action-btn svelte-1oods8b" title="Add Lesson">📄+</button>'),ot=(o,e,t)=>e(t().id),it=k('<div class="node-actions svelte-1oods8b"><!> <!> <button class="action-btn delete-btn svelte-1oods8b" title="Delete Node">🗑️</button></div>'),dt=k('<span class="tags svelte-1oods8b"> </span>'),lt=k('<div class="children svelte-1oods8b"></div>'),ct=k('<div><div class="node-content svelte-1oods8b"><div class="node-main svelte-1oods8b"><!> <button class="node-btn svelte-1oods8b"><span class="node-icon svelte-1oods8b"> </span> <span class="node-title svelte-1oods8b"> </span></button> <!></div> <!></div> <div class="node-meta svelte-1oods8b"><span class="difficulty svelte-1oods8b"> </span> <span class="time svelte-1oods8b"> </span> <!></div></div> <!>',1),ut=(o,e)=>e(null,"folder"),vt=(o,e)=>e(null,"module"),mt=k('<div class="tree-actions svelte-1oods8b"><button class="add-btn svelte-1oods8b" title="Add Root Folder">📁+</button> <button class="add-btn svelte-1oods8b" title="Add Root Module">📚+</button></div>'),gt=(o,e)=>e(null,"folder"),pt=k('<button class="svelte-1oods8b">Create your first folder</button>'),ft=k('<div class="empty-state svelte-1oods8b"><p>No knowledge nodes yet.</p> <!></div>'),ht=k('<div class="knowledge-tree svelte-1oods8b"><div class="tree-header svelte-1oods8b"><h3 class="svelte-1oods8b">Knowledge Tree</h3> <!></div> <div class="tree-content svelte-1oods8b"><!> <!></div></div>');function es(o,e){Ve(e,!0);const t=(i,a=Ke,h=Ke)=>{var C=ct(),I=te(C);let z;var W=v(I),G=v(W),ge=v(G);{var Ae=x=>{var A=Ye();A.__click=[Xe,T,a];var U=v(A,!0);u(A),O((re,pe)=>{se(A,"aria-label",re),j(U,pe)},[()=>d(c).has(a().id)?"Collapse":"Expand",()=>d(c).has(a().id)?"▼":"▶"]),m(x,A)},Ie=x=>{var A=Ze();m(x,A)};b(ge,x=>{a().children&&a().children.length>0?x(Ae):x(Ie,!1)})}var ie=_(ge,2);ie.__click=[$e,ne,a];var ye=v(ie),De=v(ye,!0);u(ye);var ke=_(ye,2),Ce=v(ke,!0);u(ke),u(ie);var Te=_(ie,2);{var Ee=x=>{var A=et();m(x,A)};b(Te,x=>{a().progress?.completed&&x(Ee)})}u(G);var Le=_(G,2);{var je=x=>{var A=it(),U=v(A);{var re=ae=>{var ce=rt(),Ue=te(ce);Ue.__click=[tt,Y,a];var Je=_(Ue,2);Je.__click=[st,Y,a],m(ae,ce)};b(U,ae=>{a().type==="folder"&&ae(re)})}var pe=_(U,2);{var be=ae=>{var ce=nt();ce.__click=[at,Y,a],m(ae,ce)};b(pe,ae=>{(a().type!=="folder"||!a().children||a().children.length===0)&&ae(be)})}var xe=_(pe,2);xe.__click=[ot,oe,a],u(A),m(x,A)};b(Le,x=>{s()&&x(je)})}u(W);var L=_(W,2),B=v(L),$=v(B);u(B);var de=_(B,2),we=v(de);u(de);var ee=_(de,2);{var le=x=>{var A=dt(),U=v(A,!0);u(A),O(re=>j(U,re),[()=>a().metadata.tags.slice(0,2).join(", ")]),m(x,A)};b(ee,x=>{a().metadata.tags.length>0&&x(le)})}u(L),u(I);var ze=_(I,2);{var Be=x=>{var A=lt();Oe(A,21,()=>a().children,U=>U.id,(U,re)=>{t(U,()=>d(re),()=>h()+1)}),u(A),m(x,A)};b(ze,x=>{a().children&&a().children.length>0&&d(c).has(a().id)&&x(Be)})}O((x,A)=>{z=fe(I,1,"tree-node svelte-1oods8b",null,z,x),Qe(I,`--depth: ${h()??""}`),se(I,"draggable",s()),se(I,"role",s()?"treeitem":"none"),se(I,"aria-label",s()?`Draggable ${a().type}: ${a().title}`:void 0),se(ie,"title",`${a().type}: ${a().title}`),j(De,A),j(Ce,a().title),j($,`Difficulty: ${a().metadata.difficulty??""}/5`),j(we,`~${a().metadata.estimatedTime??""}min`)},[()=>({current:l.content.currentNode?.id===a().id,"drop-target":d(p)===a().id}),()=>S(a())]),Pe("dragstart",I,x=>E(x,a())),Pe("dragend",I,N),Pe("dragover",I,x=>H(x,a().id)),Pe("dragleave",I,Z),Pe("drop",I,x=>J(x,a().id)),m(i,C)},r=He();let n=me(e,"nodes",19,()=>[]),s=me(e,"showActions",3,!0),c=_e(Ne(new Set)),g=_e(null),p=_e(null);const P=Me(()=>()=>n().length>0?n():D(Array.from(l.content.nodes.values())));function D(i){const a=new Map,h=[];return i.forEach(C=>{a.set(C.id,{...C,children:[]})}),i.forEach(C=>{const I=a.get(C.id);if(C.parent){const z=a.get(C.parent);z?(z.children=z.children||[],z.children.push(I)):h.push(I)}else h.push(I)}),h}function T(i){d(c).has(i)?d(c).delete(i):d(c).add(i),V(c,new Set(d(c)),!0)}function ne(i){ue.setCurrentNode(i);const a=`/knowledge/${i.id}`;Fe(a,{replaceState:!0}),r("nodeselect",i),e.onNodeSelect?.(i)}function Y(i,a="lesson"){const h={id:crypto.randomUUID(),title:"New "+a.charAt(0).toUpperCase()+a.slice(1),type:a,parent:i||void 0,metadata:{difficulty:1,estimatedTime:15,prerequisites:[],tags:[]}};ue.addKnowledgeNode(h),i&&(d(c).add(i),V(c,new Set(d(c)),!0)),r("nodeadd",i??null)}function oe(i){if(confirm("Are you sure you want to delete this node and all its children?")){const a=h=>{const C=l.content.nodes.get(h);C?.children&&C.children.forEach(I=>a(I.id)),ue.removeKnowledgeNode(h)};a(i),l.content.currentNode?.id===i&&(ue.setCurrentNode(null),Fe("/knowledge",{replaceState:!0})),r("nodedelete",i)}}function E(i,a){if(!i.dataTransfer)return;V(g,a,!0),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",a.id);const h=i.target;h.style.opacity="0.5"}function N(i){V(g,null),V(p,null);const a=i.target;a.style.opacity=""}function H(i,a){i.preventDefault(),!(!d(g)||d(g).id===a)&&(V(p,a,!0),i.dataTransfer.dropEffect="move")}function Z(){V(p,null)}function J(i,a){if(i.preventDefault(),d(g)===null||d(g).id===a)return;const h=l.content.nodes.get(a);if(!h)return;if(f(a,d(g).id)){ue.addNotification({type:"error",message:"Cannot move a node into its own descendant"});return}const C=h.type==="folder"?a:h.parent;ue.updateKnowledgeNode(d(g).id,{parent:C}),h.type==="folder"&&(d(c).add(a),V(c,new Set(d(c)),!0)),r("nodemove",{nodeId:d(g).id,newParentId:C||null}),V(g,null),V(p,null)}function f(i,a){const h=l.content.nodes.get(i);return!h||!h.parent?!1:h.parent===a?!0:f(h.parent,a)}function S(i){return i.type==="folder"?d(c).has(i.id)?"📂":"📁":i.type==="module"?"📚":"📄"}var q=ht(),y=v(q),w=_(v(y),2);{var M=i=>{var a=mt(),h=v(a);h.__click=[ut,Y];var C=_(h,2);C.__click=[vt,Y],u(a),m(i,a)};b(w,i=>{s()&&i(M)})}u(y);var R=_(y,2),Q=v(R);Oe(Q,17,()=>d(P)(),i=>i.id,(i,a)=>{t(i,()=>d(a),()=>0)});var K=_(Q,2);{var F=i=>{var a=ft(),h=_(v(a),2);{var C=I=>{var z=pt();z.__click=[gt,Y],m(I,z)};b(h,I=>{s()&&I(C)})}u(a),m(i,a)};b(K,i=>{d(P)().length===0&&i(F)})}u(R),u(q),m(o,q),Re()}Se(["click"]);Se(["click","keydown"]);const _t="InteractiveKnowledgeSystem",yt=3,kt={modules:{name:"modules",keyPath:"id",indexes:[{name:"title",keyPath:"title",unique:!1},{name:"author",keyPath:"metadata.author",unique:!1},{name:"tags",keyPath:"metadata.tags",unique:!1,multiEntry:!0},{name:"difficulty",keyPath:"metadata.difficulty",unique:!1},{name:"created",keyPath:"metadata.created",unique:!1}]},progress:{name:"progress",keyPath:["userId","moduleId"],indexes:[{name:"userId",keyPath:"userId",unique:!1},{name:"moduleId",keyPath:"moduleId",unique:!1},{name:"status",keyPath:"status",unique:!1},{name:"lastAccessed",keyPath:"lastAccessed",unique:!1}]},paths:{name:"paths",keyPath:"id",indexes:[{name:"name",keyPath:"name",unique:!1},{name:"difficulty",keyPath:"difficulty",unique:!1}]},settings:{name:"settings",keyPath:"id",indexes:[]},streaks:{name:"streaks",keyPath:"userId",indexes:[{name:"currentStreak",keyPath:"currentStreak",unique:!1},{name:"lastActivityDate",keyPath:"lastActivityDate",unique:!1}]},achievements:{name:"achievements",keyPath:"id",indexes:[{name:"userId",keyPath:"userId",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"earnedAt",keyPath:"earnedAt",unique:!1}]},links:{name:"links",keyPath:"id",indexes:[{name:"sourceId",keyPath:"sourceId",unique:!1},{name:"targetId",keyPath:"targetId",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"strength",keyPath:"strength",unique:!1},{name:"created",keyPath:"metadata.created",unique:!1},{name:"automatic",keyPath:"metadata.automatic",unique:!1}]},versions:{name:"versions",keyPath:"id",indexes:[{name:"entityType",keyPath:"entityType",unique:!1},{name:"entityId",keyPath:"entityId",unique:!1},{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"entityVersion",keyPath:["entityId","version"],unique:!0}]},offline_queue:{name:"offline_queue",keyPath:"id",indexes:[{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"entity",keyPath:"entity",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"priority",keyPath:"priority",unique:!1}]},sync_conflicts:{name:"sync_conflicts",keyPath:"id",indexes:[{name:"operationId",keyPath:"operationId",unique:!1},{name:"conflictType",keyPath:"conflictType",unique:!1},{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"resolved",keyPath:"resolved",unique:!1}]},web_sources:{name:"web_sources",keyPath:"id",indexes:[{name:"url",keyPath:"url",unique:!1},{name:"domain",keyPath:"domain",unique:!1},{name:"status",keyPath:"status",unique:!1},{name:"importDate",keyPath:"importDate",unique:!1},{name:"lastChecked",keyPath:"lastChecked",unique:!1},{name:"category",keyPath:"metadata.category",unique:!1},{name:"tags",keyPath:"metadata.tags",unique:!1,multiEntry:!0},{name:"author",keyPath:"metadata.author",unique:!1},{name:"timesReferenced",keyPath:"usage.timesReferenced",unique:!1}]}};class wt{db=null;initPromise=null;get available(){return typeof window<"u"&&typeof window.indexedDB<"u"}async init(){return this.initPromise?this.initPromise:this.available?(this.initPromise=new Promise((e,t)=>{const r=setTimeout(()=>{t(new Error("Database initialization timeout"))},5e3),n=window.indexedDB.open(_t,yt);n.onerror=()=>{clearTimeout(r),t(new Error(`Failed to open database: ${n.error?.message}`))},n.onsuccess=()=>{clearTimeout(r),this.db=n.result,e()},n.onupgradeneeded=s=>{const c=s.target.result;this.createObjectStores(c)}}),this.initPromise):(this.initPromise=Promise.resolve(),this.initPromise)}createObjectStores(e){Object.values(kt).forEach(t=>{if(!e.objectStoreNames.contains(t.name)){const r=e.createObjectStore(t.name,{keyPath:t.keyPath});t.indexes.forEach(n=>{const s=Array.isArray(n.keyPath)?[...n.keyPath]:n.keyPath,c={unique:n.unique};"multiEntry"in n&&(c.multiEntry=n.multiEntry||!1),r.createIndex(n.name,s,c)})}})}async ensureInitialized(){if(!this.available)throw new Error("IndexedDB is not available in this environment");if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async get(e,t){if(!this.available)return;const r=await this.ensureInitialized();return new Promise((n,s)=>{const p=r.transaction([e],"readonly").objectStore(e).get(t);p.onsuccess=()=>n(p.result),p.onerror=()=>s(p.error)})}async getAll(e,t,r){if(!this.available)return[];const n=await this.ensureInitialized();return new Promise((s,c)=>{const P=n.transaction([e],"readonly").objectStore(e).getAll(t,r);P.onsuccess=()=>s(P.result),P.onerror=()=>c(P.error)})}async add(e,t,r){if(!this.available)return;const n=await this.ensureInitialized();return new Promise((s,c)=>{const g=n.transaction([e,"versions"],"readwrite"),p=g.objectStore(e),P=g.objectStore("versions"),D=p.add(t);D.onsuccess=()=>{if(this.shouldVersion(e)){const T=this.createVersionRecord(e,t,r);P.add(T)}},g.oncomplete=()=>s(),g.onerror=()=>c(g.error)})}async put(e,t,r){if(!this.available)return;const n=await this.ensureInitialized();return new Promise((s,c)=>{const g=n.transaction([e,"versions"],"readwrite"),p=g.objectStore(e),P=g.objectStore("versions"),D=p.put(t);D.onsuccess=()=>{if(this.shouldVersion(e)){const T=this.createVersionRecord(e,t,r);P.add(T)}},g.oncomplete=()=>s(),g.onerror=()=>c(g.error)})}async delete(e,t){if(!this.available)return;const r=await this.ensureInitialized();return new Promise((n,s)=>{const c=r.transaction([e],"readwrite");c.objectStore(e).delete(t),c.oncomplete=()=>n(),c.onerror=()=>s(c.error)})}async searchByIndex(e,t,r,n){if(!this.available)return[];const s=await this.ensureInitialized();return new Promise((c,g)=>{const T=s.transaction([e],"readonly").objectStore(e).index(t).getAll(r,n);T.onsuccess=()=>c(T.result),T.onerror=()=>g(T.error)})}async getVersionHistory(e,t){if(!this.available)return[];const r=await this.ensureInitialized();return new Promise((n,s)=>{const P=r.transaction(["versions"],"readonly").objectStore("versions").index("entityId").getAll(e);P.onsuccess=()=>{const D=P.result.filter(T=>T.entityType===t);D.sort((T,ne)=>ne.timestamp.getTime()-T.timestamp.getTime()),n(D)},P.onerror=()=>s(P.error)})}async getVersion(e,t){if(!this.available)return;const r=await this.ensureInitialized();return new Promise((n,s)=>{const P=r.transaction(["versions"],"readonly").objectStore("versions").index("entityVersion").get([e,t]);P.onsuccess=()=>n(P.result),P.onerror=()=>s(P.error)})}shouldVersion(e){return["modules","paths","settings"].includes(e)}createVersionRecord(e,t,r){const n=this.getEntityId(t),s=this.getEntityVersion(t);return{id:`${n}_v${s}_${Date.now()}`,entityType:e==="modules"?"module":e==="paths"?"path":"settings",entityId:n,version:s,data:structuredClone(t),timestamp:new Date,changeDescription:r}}getEntityId(e){return e.id||e.userId||"unknown"}getEntityVersion(e){return e.metadata?.version||e.version||1}close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const X=new wt;Se(["click","change","mousedown"]);var bt=We('<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'),xt=We('<svg class="w-4 h-4 text-blue-600 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),Pt=k('<div class="w-2 h-2 bg-gray-400 rounded-full"></div>'),St=k('<div><svg class="absolute inset-0 w-full h-full transform -rotate-90" viewBox="0 0 36 36"><path class="stroke-gray-200" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path><path stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path></svg> <div class="relative z-10 flex items-center justify-center"><!></div></div>'),At=k('<span class="text-sm text-gray-500"> </span>'),It=k('<div class="w-full"><div class="flex justify-between items-center mb-1"><span class="text-sm font-medium text-gray-700"> </span> <!></div> <div class="w-full bg-gray-200 rounded-full h-2"><div></div></div></div>'),Dt=k("<span><!> <!></span>"),Tt=k("<div> </div>"),qt=k("<div> </div>"),Mt=k("<div> </div>"),Ct=k('<div class="mt-2 text-xs text-gray-600 space-y-1"><!> <!> <!></div>'),Et=k("<!> <!>",1);function Lt(o,e){Ve(e,!0);let t=me(e,"showDetails",3,!1),r=me(e,"size",3,"medium"),n=me(e,"variant",3,"circular");const s=Me(()=>()=>{if(!e.progress)return 0;switch(e.progress.status){case"completed":return 100;case"in-progress":return 50;case"not-started":default:return 0}}),c=Me(()=>()=>{if(!e.progress)return"gray";switch(e.progress.status){case"completed":return"green";case"in-progress":return"blue";case"not-started":default:return"gray"}}),g=E=>{if(E<60)return`${E}m`;const N=Math.floor(E/60),H=E%60;return H>0?`${N}h ${H}m`:`${N}h`},p=Me(()=>()=>{switch(r()){case"small":return"w-6 h-6 text-xs";case"large":return"w-16 h-16 text-lg";case"medium":default:return"w-10 h-10 text-sm"}});var P=Et(),D=te(P);{var T=E=>{var N=St(),H=v(N),Z=_(v(H));u(H);var J=_(H,2),f=v(J);{var S=y=>{var w=bt();m(y,w)},q=y=>{var w=he(),M=te(w);{var R=K=>{var F=xt();m(K,F)},Q=K=>{var F=Pt();m(K,F)};b(M,K=>{e.progress?.status==="in-progress"?K(R):K(Q,!1)},!0)}m(y,w)};b(f,y=>{e.progress?.status==="completed"?y(S):y(q,!1)})}u(J),u(N),O((y,w,M)=>{fe(N,1,`relative inline-flex items-center justify-center ${y??""}`,"svelte-ohjugr"),fe(Z,0,`stroke-${w??""}-500 transition-all duration-300`,"svelte-ohjugr"),se(Z,"stroke-dasharray",`${M??""}, 100`)},[()=>d(p)(),()=>d(c)(),()=>d(s)()]),m(E,N)},ne=E=>{var N=he(),H=te(N);{var Z=f=>{var S=It(),q=v(S),y=v(q),w=v(y,!0);u(y);var M=_(y,2);{var R=F=>{var i=At(),a=v(i);u(i),O(()=>j(a,`${e.progress.score??""}%`)),m(F,i)};b(M,F=>{e.progress?.score!==void 0&&F(R)})}u(q);var Q=_(q,2),K=v(Q);u(Q),u(S),O((F,i)=>{j(w,e.progress?.status==="completed"?"Completed":e.progress?.status==="in-progress"?"In Progress":"Not Started"),fe(K,1,`bg-${F??""}-500 h-2 rounded-full transition-all duration-300`,"svelte-ohjugr"),Qe(K,`width: ${i??""}%`)},[()=>d(c)(),()=>d(s)()]),m(f,S)},J=f=>{var S=he(),q=te(S);{var y=w=>{var M=Dt(),R=v(M);{var Q=a=>{var h=qe("✓ Completed");m(a,h)},K=a=>{var h=he(),C=te(h);{var I=W=>{var G=qe("⏳ In Progress");m(W,G)},z=W=>{var G=qe("○ Not Started");m(W,G)};b(C,W=>{e.progress?.status==="in-progress"?W(I):W(z,!1)},!0)}m(a,h)};b(R,a=>{e.progress?.status==="completed"?a(Q):a(K,!1)})}var F=_(R,2);{var i=a=>{var h=qe();O(()=>j(h,`(${e.progress.score??""}%)`)),m(a,h)};b(F,a=>{e.progress?.score!==void 0&&a(i)})}u(M),O((a,h)=>fe(M,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${a??""}-100 text-${h??""}-800`,"svelte-ohjugr"),[()=>d(c)(),()=>d(c)()]),m(w,M)};b(q,w=>{n()==="badge"&&w(y)},!0)}m(f,S)};b(H,f=>{n()==="linear"?f(Z):f(J,!1)},!0)}m(E,N)};b(D,E=>{n()==="circular"?E(T):E(ne,!1)})}var Y=_(D,2);{var oe=E=>{var N=Ct(),H=v(N);{var Z=y=>{var w=Tt(),M=v(w);u(w),O(R=>j(M,`Time spent: ${R??""}`),[()=>g(e.progress.timeSpent)]),m(y,w)};b(H,y=>{e.progress.timeSpent>0&&y(Z)})}var J=_(H,2);{var f=y=>{var w=qt(),M=v(w);u(w),O(()=>j(M,`Attempts: ${e.progress.attempts??""}`)),m(y,w)};b(J,y=>{e.progress.attempts>0&&y(f)})}var S=_(J,2);{var q=y=>{var w=Mt(),M=v(w);u(w),O(R=>j(M,`Last accessed: ${R??""}`),[()=>e.progress.lastAccessed.toLocaleDateString()]),m(y,w)};b(S,y=>{e.progress.lastAccessed&&y(q)})}u(N),m(E,N)};b(Y,E=>{t()&&e.progress&&E(oe)})}m(o,P),Re()}class jt{async updateProgress(e){const t={...e,lastAccessed:new Date};await X.put("progress",t)}async getProgress(e,t){return await X.get("progress",[e,t])}async getUserProgress(e){return await X.searchByIndex("progress","userId",e)}async getModuleProgress(e){return await X.searchByIndex("progress","moduleId",e)}async getCompletedModules(e){return(await this.getUserProgress(e)).filter(r=>r.status==="completed")}async getInProgressModules(e){return(await this.getUserProgress(e)).filter(r=>r.status==="in-progress")}async getBookmarkedModules(e){return(await this.getUserProgress(e)).filter(r=>r.bookmarked)}async completeModule(e,t,r){const n=await this.getProgress(e,t),s={userId:e,moduleId:t,status:"completed",score:r,timeSpent:n?.timeSpent||0,lastAccessed:new Date,attempts:(n?.attempts||0)+1,bookmarked:n?.bookmarked||!1,notes:n?.notes||""};await this.updateProgress(s)}async startModule(e,t){const r=await this.getProgress(e,t),n={userId:e,moduleId:t,status:"in-progress",timeSpent:r?.timeSpent||0,lastAccessed:new Date,attempts:r?.attempts||0,bookmarked:r?.bookmarked||!1,notes:r?.notes||""};await this.updateProgress(n)}async addTimeSpent(e,t,r){const n=await this.getProgress(e,t);n&&(n.timeSpent+=r,await this.updateProgress(n))}async toggleBookmark(e,t){const n=await this.getProgress(e,t)||{userId:e,moduleId:t,status:"not-started",timeSpent:0,lastAccessed:new Date,attempts:0,bookmarked:!1,notes:""};return n.bookmarked=!n.bookmarked,await this.updateProgress(n),n.bookmarked}async updateNotes(e,t,r){const s=await this.getProgress(e,t)||{userId:e,moduleId:t,status:"not-started",timeSpent:0,lastAccessed:new Date,attempts:0,bookmarked:!1,notes:""};s.notes=r,await this.updateProgress(s)}async getRecentlyAccessed(e,t=10){return(await this.getUserProgress(e)).sort((n,s)=>s.lastAccessed.getTime()-n.lastAccessed.getTime()).slice(0,t)}async deleteProgress(e,t){await X.delete("progress",[e,t])}async deleteUserProgress(e){const t=await this.getUserProgress(e);for(const r of t)await X.delete("progress",[r.userId,r.moduleId])}async getProgressStats(e){const t=await this.getUserProgress(e),r=t.filter(D=>D.status==="completed"),n=t.filter(D=>D.status==="in-progress"),s=t.reduce((D,T)=>D+T.timeSpent,0),c=r.length>0?r.reduce((D,T)=>D+(T.score||0),0)/r.length:0,g=t.length>0?r.length/t.length*100:0,p=await this.getLearningStreak(e),P=t.length>0?new Date(Math.max(...t.map(D=>D.lastAccessed.getTime()))):new Date;return{totalModules:t.length,completedModules:r.length,inProgressModules:n.length,completionRate:g,averageScore:c,totalTimeSpent:s,currentStreak:p.currentStreak,longestStreak:p.longestStreak,lastActivityDate:P}}async getLearningStreak(e){let t=await X.get("streaks",e);return t||(t={userId:e,currentStreak:0,longestStreak:0,lastActivityDate:new Date,streakStartDate:new Date},await X.add("streaks",t)),t}async updateLearningStreak(e){const t=await this.getLearningStreak(e),r=new Date,n=new Date(t.lastActivityDate),s=r.toDateString()!==n.toDateString(),c=Math.floor((r.getTime()-n.getTime())/(1e3*60*60*24));return s&&(c===1?(t.currentStreak+=1,t.currentStreak>t.longestStreak&&(t.longestStreak=t.currentStreak)):c>1&&(t.currentStreak=1,t.streakStartDate=r)),t.lastActivityDate=r,await X.put("streaks",t),t}async getUserAchievements(e){return await X.searchByIndex("achievements","userId",e)}async awardAchievement(e){await X.add("achievements",e)}async checkAndAwardAchievements(e){const t=await this.getProgressStats(e),r=await this.getUserAchievements(e),n=[];if(t.completedModules>=1&&!r.some(s=>s.type==="completion"&&s.id==="first-completion")){const s={id:"first-completion",userId:e,type:"completion",title:"First Steps",description:"Completed your first module!",earnedAt:new Date,metadata:{modulesCompleted:t.completedModules}};await this.awardAchievement(s),n.push(s)}if(t.currentStreak>=7&&!r.some(s=>s.type==="streak"&&s.id==="week-streak")){const s={id:"week-streak",userId:e,type:"streak",title:"Week Warrior",description:"Maintained a 7-day learning streak!",earnedAt:new Date,metadata:{streakLength:t.currentStreak}};await this.awardAchievement(s),n.push(s)}if(t.averageScore>=90&&t.completedModules>=5&&!r.some(s=>s.type==="score"&&s.id==="high-achiever")){const s={id:"high-achiever",userId:e,type:"score",title:"High Achiever",description:"Maintained 90%+ average score across 5+ modules!",earnedAt:new Date,metadata:{averageScore:t.averageScore,modulesCompleted:t.completedModules}};await this.awardAchievement(s),n.push(s)}return n}}const ve=new jt;Se(["click"]);const zt=async(o,e,t,r,n,s)=>{try{await ve.startModule(e.userId,e.moduleId),await t(),r()&&n(),await ve.updateLearningStreak(e.userId)}catch(c){V(s,c instanceof Error?c.message:"Failed to start module",!0),console.error("Error starting module:",c)}},Bt=async(o,e,t,r,n)=>{try{const s=await ve.toggleBookmark(e.userId,e.moduleId);d(t)&&(d(t).bookmarked=s,l.progress.userProgress.set(e.moduleId,d(t)),r("progressupdate",d(t)))}catch(s){V(n,s instanceof Error?s.message:"Failed to toggle bookmark",!0),console.error("Error toggling bookmark:",s)}};var Nt=k('<div class="bg-red-50 border border-red-200 rounded-md p-3 mb-4"><div class="flex"><svg class="w-4 h-4 text-red-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> <div class="ml-2"><p class="text-sm text-red-700"> </p></div></div></div>'),Vt=k('<div class="flex items-center justify-center py-4"><div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div> <span class="ml-2 text-sm text-gray-600">Loading progress...</span></div>'),Rt=k('<p class="text-xs text-gray-600"> </p>'),Ut=k('<span class="text-blue-600"> </span>'),Ot=k('<button class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 transition-colors">Start Learning</button>'),Kt=(o,e)=>e(),Ft=k('<button class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-green-700 transition-colors">Mark Complete</button>'),Ht=k('<div class="text-xs text-green-600 mt-1"> </div>'),Qt=k('<div class="flex-1 bg-green-100 text-green-800 px-4 py-2 rounded-md text-sm font-medium text-center">✓ Completed <!></div>'),Wt=k('<div class="flex space-x-2"><!></div>'),Jt=k('<div class="mt-3 pt-3 border-t border-gray-100"><p class="text-xs text-gray-500"> </p></div>'),Gt=k('<div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-3"><!> <div><p class="text-sm font-medium text-gray-900"> </p> <!></div></div> <div class="flex items-center space-x-2"><button class="p-1 rounded-md hover:bg-gray-100 transition-colors" type="button"><svg stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg></button></div></div> <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4"><div><span class="font-medium">Time spent:</span> <span class="ml-1"> <!></span></div> <div><span class="font-medium">Attempts:</span> <span class="ml-1"> </span></div></div> <!> <!>',1),Xt=k('<div class="progress-tracker bg-white border border-gray-200 rounded-lg p-4 svelte-w6vutz"><!> <!></div>');function ts(o,e){Ve(e,!0);const t=He();let r=me(e,"autoTrackTime",3,!0),n=me(e,"showControls",3,!0),s=_e(null),c=_e(!0),g=_e(null),p=Ne({startTime:null,intervalId:null,sessionTime:0});const P=async()=>{try{V(c,!0),V(g,null);const f=await ve.getProgress(e.userId,e.moduleId);V(s,f||{userId:e.userId,moduleId:e.moduleId,status:"not-started",timeSpent:0,lastAccessed:new Date,attempts:0,bookmarked:!1,notes:""},!0),l.progress.userProgress.set(e.moduleId,d(s))}catch(f){V(g,f instanceof Error?f.message:"Failed to load progress",!0),console.error("Error loading progress:",f)}finally{V(c,!1)}},D=()=>{!r()||p.startTime||(p.startTime=new Date,p.intervalId=setInterval(()=>{p.startTime&&(p.sessionTime=Math.floor((Date.now()-p.startTime.getTime())/1e3/60))},6e4))},T=async()=>{if(!p.startTime||!d(s))return;const f=Math.floor((Date.now()-p.startTime.getTime())/1e3/60);p.intervalId&&(clearInterval(p.intervalId),p.intervalId=null),f>0&&(await ve.addTimeSpent(e.userId,e.moduleId,f),d(s).timeSpent+=f,l.progress.userProgress.set(e.moduleId,d(s)),t("progressupdate",d(s))),p.startTime=null,p.sessionTime=0},ne=async f=>{try{await T(),await ve.completeModule(e.userId,e.moduleId,f),await P(),l.progress.completedModules.add(e.moduleId);const S=await ve.checkAndAwardAchievements(e.userId);for(const q of S)ue.addNotification({type:"success",message:`🎉 Achievement unlocked: ${q.title}!`})}catch(S){V(g,S instanceof Error?S.message:"Failed to complete module",!0),console.error("Error completing module:",S)}},Y=f=>{if(f<60)return`${f}m`;const S=Math.floor(f/60),q=f%60;return q>0?`${S}h ${q}m`:`${S}h`};Ge(()=>(P(),r()&&setTimeout(()=>{d(s)?.status==="in-progress"&&D()},100),()=>{T()}));var oe=Xt(),E=v(oe);{var N=f=>{var S=Nt(),q=v(S),y=_(v(q),2),w=v(y),M=v(w,!0);u(w),u(y),u(q),u(S),O(()=>j(M,d(g))),m(f,S)};b(E,f=>{d(g)&&f(N)})}var H=_(E,2);{var Z=f=>{var S=Vt();m(f,S)},J=f=>{var S=he(),q=te(S);{var y=w=>{var M=Gt(),R=te(M),Q=v(R),K=v(Q);Lt(K,{get progress(){return d(s)},size:"medium"});var F=_(K,2),i=v(F),a=v(i,!0);u(i);var h=_(i,2);{var C=L=>{var B=Rt(),$=v(B);u(B),O(()=>j($,`Score: ${d(s).score??""}%`)),m(L,B)};b(h,L=>{d(s).score!==void 0&&L(C)})}u(F),u(Q);var I=_(Q,2),z=v(I);z.__click=[Bt,e,s,t,g];var W=v(z);u(z),u(I),u(R);var G=_(R,2),ge=v(G),Ae=_(v(ge),2),Ie=v(Ae),ie=_(Ie);{var ye=L=>{var B=Ut(),$=v(B);u(B),O(()=>j($,`(+${p.sessionTime??""}m this session)`)),m(L,B)};b(ie,L=>{p.sessionTime>0&&L(ye)})}u(Ae),u(ge);var De=_(ge,2),ke=_(v(De),2),Ce=v(ke,!0);u(ke),u(De),u(G);var Te=_(G,2);{var Ee=L=>{var B=Wt(),$=v(B);{var de=ee=>{var le=Ot();le.__click=[zt,e,P,r,D,g],m(ee,le)},we=ee=>{var le=he(),ze=te(le);{var Be=A=>{var U=Ft();U.__click=[Kt,ne],m(A,U)},x=A=>{var U=Qt(),re=_(v(U));{var pe=be=>{var xe=Ht(),ae=v(xe,!0);u(xe),O(ce=>j(ae,ce),[()=>d(s).completedAt.toLocaleDateString()]),m(be,xe)};b(re,be=>{d(s).completedAt&&be(pe)})}u(U),m(A,U)};b(ze,A=>{d(s).status==="in-progress"?A(Be):A(x,!1)},!0)}m(ee,le)};b($,ee=>{d(s).status==="not-started"?ee(de):ee(we,!1)})}u(B),m(L,B)};b(Te,L=>{n()&&L(Ee)})}var Le=_(Te,2);{var je=L=>{var B=Jt(),$=v(B),de=v($);u($),u(B),O((we,ee)=>j(de,`Last accessed: ${we??""} at ${ee??""}`),[()=>d(s).lastAccessed.toLocaleDateString(),()=>d(s).lastAccessed.toLocaleTimeString()]),m(L,B)};b(Le,L=>{d(s).lastAccessed&&L(je)})}O(L=>{j(a,d(s).status==="completed"?"Completed":d(s).status==="in-progress"?"In Progress":"Not Started"),se(z,"title",d(s).bookmarked?"Remove bookmark":"Add bookmark"),se(z,"aria-label",d(s).bookmarked?"Remove bookmark":"Add bookmark"),se(z,"aria-pressed",d(s).bookmarked),fe(W,0,`w-4 h-4 ${d(s).bookmarked?"text-yellow-500 fill-current":"text-gray-400"}`),se(W,"fill",d(s).bookmarked?"currentColor":"none"),j(Ie,`${L??""} `),j(Ce,d(s).attempts)},[()=>Y(d(s).timeSpent)]),m(w,M)};b(q,w=>{d(s)&&w(y)},!0)}m(f,S)};b(H,f=>{d(c)?f(Z):f(J,!1)})}u(oe),m(o,oe),Re()}Se(["click"]);export{es as K,ts as P,ue as a,l as b,Zt as c,$t as g,X as s};
