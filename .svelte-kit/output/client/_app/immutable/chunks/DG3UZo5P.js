import{b as Be,d as Ye,p as We,B as tt,a as Pe,s as ce,f as A,k as D,j as Qe,n as p,o as Je,h as n,i as u,r as a,g as s,c as He,O as at,e as N,C as _e,t as H,x as Te,I as je,y as O,q,H as Ee,P as nt,M as ot,J as Ge,G as _t,w as Me,E as Re,D as Ve,A as ht,u as yt}from"./d1NyGob4.js";const f=Be({user:{id:"",settings:null,isAuthenticated:!1},content:{nodes:new Map,currentNode:null,searchQuery:"",searchResults:[],isLoading:!1},progress:{completedModules:new Set,currentStreak:0,totalTimeSpent:0,userProgress:new Map},sync:{isOnline:typeof navigator<"u"?navigator.onLine:!0,lastSync:null,pendingChanges:[],isSyncing:!1},ui:{sidebarOpen:!0,currentView:"dashboard",theme:"light",notifications:[]}});function Ls(){const{nodes:l,searchQuery:e}=f.content;if(!e.trim())return Array.from(l.values());const t=e.toLowerCase();return Array.from(l.values()).filter(o=>o.title.toLowerCase().includes(t)||o.metadata.tags.some(d=>d.toLowerCase().includes(t)))}function js(){const{completedModules:l,userProgress:e}=f.progress,t=f.content.nodes.size,o=t>0?l.size/t*100:0;let d=0;const r=Array.from(e.values());return r.length>0&&(d=r.reduce((_,x)=>_+(x.score||0),0)/r.length),{totalModules:t,completedModules:l.size,completionRate:o,averageScore:d,currentStreak:f.progress.currentStreak}}const Le={setCurrentNode:l=>{f.content.currentNode=l},addKnowledgeNode:l=>{const e=new Map(f.content.nodes);e.set(l.id,l),f.content.nodes=e},updateKnowledgeNode:(l,e)=>{const t=f.content.nodes.get(l);if(t){const o=new Map(f.content.nodes);o.set(l,{...t,...e}),f.content.nodes=o}},removeKnowledgeNode:l=>{const e=new Map(f.content.nodes);e.delete(l),f.content.nodes=e;const t=new Set(f.progress.completedModules);t.delete(l),f.progress.completedModules=t;const o=new Map(f.progress.userProgress);o.delete(l),f.progress.userProgress=o},setSearchQuery:l=>{f.content.searchQuery=l},setSearchResults:l=>{f.content.searchResults=l},markModuleCompleted:(l,e)=>{const t=new Set(f.progress.completedModules);t.add(l),f.progress.completedModules=t;const o=f.progress.userProgress.get(l),d={userId:f.user.id,moduleId:l,status:"completed",score:e,timeSpent:o?.timeSpent||0,lastAccessed:new Date,attempts:(o?.attempts||0)+1,bookmarked:o?.bookmarked||!1,notes:o?.notes||"",completedAt:new Date},r=new Map(f.progress.userProgress);r.set(l,d),f.progress.userProgress=r},startModule:l=>{const e=f.progress.userProgress.get(l),t={userId:f.user.id,moduleId:l,status:"in-progress",timeSpent:e?.timeSpent||0,lastAccessed:new Date,attempts:e?.attempts||0,bookmarked:e?.bookmarked||!1,notes:e?.notes||"",startedAt:e?.startedAt||new Date},o=new Map(f.progress.userProgress);o.set(l,t),f.progress.userProgress=o},updateTimeSpent:(l,e)=>{const t=f.progress.userProgress.get(l);if(t){const o={...t,timeSpent:t.timeSpent+e,lastAccessed:new Date},d=new Map(f.progress.userProgress);d.set(l,o),f.progress.userProgress=d}},loadUserProgress:l=>{f.progress.userProgress=new Map(l);const e=new Set;for(const[t,o]of l)o.status==="completed"&&e.add(t);f.progress.completedModules=e,f.progress.totalTimeSpent=Array.from(l.values()).reduce((t,o)=>t+o.timeSpent,0)},updateUserProgress:(l,e)=>{const t=f.progress.userProgress.get(l);if(t){const o=new Map(f.progress.userProgress);o.set(l,{...t,...e}),f.progress.userProgress=o}},toggleSidebar:()=>{f.ui.sidebarOpen=!f.ui.sidebarOpen},setCurrentView:l=>{f.ui.currentView=l},addNotification:l=>{const e=crypto.randomUUID();f.ui.notifications.push({...l,id:e,timestamp:new Date})},removeNotification:l=>{const e=f.ui.notifications.findIndex(t=>t.id===l);e>-1&&f.ui.notifications.splice(e,1)},setOnlineStatus:l=>{f.sync.isOnline=l},addPendingChange:l=>{f.sync.pendingChanges.includes(l)||f.sync.pendingChanges.push(l)},removePendingChange:l=>{const e=f.sync.pendingChanges.indexOf(l);e>-1&&f.sync.pendingChanges.splice(e,1)},setSyncStatus:l=>{f.sync.isSyncing=l,l||(f.sync.lastSync=new Date)}};var xt=(l,e,t)=>e(t().id),bt=A('<button class="expand-btn svelte-1oods8b"> </button>'),kt=A('<span class="expand-spacer svelte-1oods8b"></span>'),wt=(l,e,t)=>e(t()),Pt=A('<span class="completion-badge svelte-1oods8b" title="Completed">✅</span>'),St=(l,e,t)=>e(t().id,"folder"),At=(l,e,t)=>e(t().id,"module"),It=A('<button class="action-btn svelte-1oods8b" title="Add Subfolder">📁+</button> <button class="action-btn svelte-1oods8b" title="Add Module">📚+</button>',1),Mt=(l,e,t)=>e(t().parent||null,"lesson"),Dt=A('<button class="action-btn svelte-1oods8b" title="Add Lesson">📄+</button>'),qt=(l,e,t)=>e(t().id),Tt=A('<div class="node-actions svelte-1oods8b"><!> <!> <button class="action-btn delete-btn svelte-1oods8b" title="Delete Node">🗑️</button></div>'),Ct=A('<span class="tags svelte-1oods8b"> </span>'),zt=A('<div class="children svelte-1oods8b"></div>'),Lt=A('<div><div class="node-content svelte-1oods8b"><div class="node-main svelte-1oods8b"><!> <button class="node-btn svelte-1oods8b"><span class="node-icon svelte-1oods8b"> </span> <span class="node-title svelte-1oods8b"> </span></button> <!></div> <!></div> <div class="node-meta svelte-1oods8b"><span class="difficulty svelte-1oods8b"> </span> <span class="time svelte-1oods8b"> </span> <!></div></div> <!>',1),jt=(l,e)=>e(null,"folder"),Et=(l,e)=>e(null,"module"),Rt=A('<div class="tree-actions svelte-1oods8b"><button class="add-btn svelte-1oods8b" title="Add Root Folder">📁+</button> <button class="add-btn svelte-1oods8b" title="Add Root Module">📚+</button></div>'),Bt=(l,e)=>e(null,"folder"),Nt=A('<button class="svelte-1oods8b">Create your first folder</button>'),Ot=A('<div class="empty-state svelte-1oods8b"><p>No knowledge nodes yet.</p> <!></div>'),Ut=A('<div class="knowledge-tree svelte-1oods8b"><div class="tree-header svelte-1oods8b"><h3 class="svelte-1oods8b">Knowledge Tree</h3> <!></div> <div class="tree-content svelte-1oods8b"><!> <!></div></div>');function Es(l,e){We(e,!0);const t=(v,i=at,S=at)=>{var B=Lt(),R=_e(B);let h;var c=n(R),k=n(c),I=n(k);{var V=j=>{var E=bt();E.__click=[xt,T,i];var ne=n(E,!0);a(E),H((xe,Ae)=>{O(E,"aria-label",xe),q(ne,Ae)},[()=>s(g).has(i().id)?"Collapse":"Expand",()=>s(g).has(i().id)?"▼":"▶"]),p(j,E)},z=j=>{var E=kt();p(j,E)};D(I,j=>{i().children&&i().children.length>0?j(V):j(z,!1)})}var te=u(I,2);te.__click=[wt,ue,i];var ae=n(te),se=n(ae,!0);a(ae);var Z=u(ae,2),U=n(Z,!0);a(Z),a(te);var F=u(te,2);{var $=j=>{var E=Pt();p(j,E)};D(F,j=>{i().progress?.completed&&j($)})}a(k);var me=u(k,2);{var De=j=>{var E=Tt(),ne=n(E);{var xe=pe=>{var Ie=It(),Xe=_e(Ie);Xe.__click=[St,oe,i];var Ze=u(Xe,2);Ze.__click=[At,oe,i],p(pe,Ie)};D(ne,pe=>{i().type==="folder"&&pe(xe)})}var Ae=u(ne,2);{var qe=pe=>{var Ie=Dt();Ie.__click=[Mt,oe,i],p(pe,Ie)};D(Ae,pe=>{(i().type!=="folder"||!i().children||i().children.length===0)&&pe(qe)})}var ze=u(Ae,2);ze.__click=[qt,he,i],a(E),p(j,E)};D(me,j=>{r()&&j(De)})}a(c);var K=u(c,2),J=n(K),le=n(J);a(J);var ye=u(J,2),Se=n(ye);a(ye);var ve=u(ye,2);{var ke=j=>{var E=Ct(),ne=n(E,!0);a(E),H(xe=>q(ne,xe),[()=>i().metadata.tags.slice(0,2).join(", ")]),p(j,E)};D(ve,j=>{i().metadata.tags.length>0&&j(ke)})}a(K),a(R);var Ce=u(R,2);{var Ne=j=>{var E=zt();Qe(E,21,()=>i().children,ne=>ne.id,(ne,xe)=>{t(ne,()=>s(xe),()=>S()+1)}),a(E),p(j,E)};D(Ce,j=>{i().children&&i().children.length>0&&s(g).has(i().id)&&j(Ne)})}H((j,E)=>{h=Te(R,1,"tree-node svelte-1oods8b",null,h,j),je(R,`--depth: ${S()??""}`),O(R,"draggable",r()),O(R,"role",r()?"treeitem":"none"),O(R,"aria-label",r()?`Draggable ${i().type}: ${i().title}`:void 0),O(te,"title",`${i().type}: ${i().title}`),q(se,E),q(U,i().title),q(le,`Difficulty: ${i().metadata.difficulty??""}/5`),q(Se,`~${i().metadata.estimatedTime??""}min`)},[()=>({current:f.content.currentNode?.id===i().id,"drop-target":s(x)===i().id}),()=>m(i())]),Ee("dragstart",R,j=>Q(j,i())),Ee("dragend",R,G),Ee("dragover",R,j=>re(j,i().id)),Ee("dragleave",R,ie),Ee("drop",R,j=>de(j,i().id)),p(v,B)},o=tt();let d=Pe(e,"nodes",19,()=>[]),r=Pe(e,"showActions",3,!0),g=ce(Be(new Set)),_=ce(null),x=ce(null);const M=He(()=>()=>d().length>0?d():L(Array.from(f.content.nodes.values())));function L(v){const i=new Map,S=[];return v.forEach(B=>{i.set(B.id,{...B,children:[]})}),v.forEach(B=>{const R=i.get(B.id);if(B.parent){const h=i.get(B.parent);h?(h.children=h.children||[],h.children.push(R)):S.push(R)}else S.push(R)}),S}function T(v){s(g).has(v)?s(g).delete(v):s(g).add(v),N(g,new Set(s(g)),!0)}function ue(v){Le.setCurrentNode(v);const i=`/knowledge/${v.id}`;nt(i,{replaceState:!0}),o("nodeselect",v),e.onNodeSelect?.(v)}function oe(v,i="lesson"){const S={id:crypto.randomUUID(),title:"New "+i.charAt(0).toUpperCase()+i.slice(1),type:i,parent:v||void 0,metadata:{difficulty:1,estimatedTime:15,prerequisites:[],tags:[]}};Le.addKnowledgeNode(S),v&&(s(g).add(v),N(g,new Set(s(g)),!0)),o("nodeadd",v??null)}function he(v){if(confirm("Are you sure you want to delete this node and all its children?")){const i=S=>{const B=f.content.nodes.get(S);B?.children&&B.children.forEach(R=>i(R.id)),Le.removeKnowledgeNode(S)};i(v),f.content.currentNode?.id===v&&(Le.setCurrentNode(null),nt("/knowledge",{replaceState:!0})),o("nodedelete",v)}}function Q(v,i){if(!v.dataTransfer)return;N(_,i,!0),v.dataTransfer.effectAllowed="move",v.dataTransfer.setData("text/plain",i.id);const S=v.target;S.style.opacity="0.5"}function G(v){N(_,null),N(x,null);const i=v.target;i.style.opacity=""}function re(v,i){v.preventDefault(),!(!s(_)||s(_).id===i)&&(N(x,i,!0),v.dataTransfer.dropEffect="move")}function ie(){N(x,null)}function de(v,i){if(v.preventDefault(),s(_)===null||s(_).id===i)return;const S=f.content.nodes.get(i);if(!S)return;if(w(i,s(_).id)){Le.addNotification({type:"error",message:"Cannot move a node into its own descendant"});return}const B=S.type==="folder"?i:S.parent;Le.updateKnowledgeNode(s(_).id,{parent:B}),S.type==="folder"&&(s(g).add(i),N(g,new Set(s(g)),!0)),o("nodemove",{nodeId:s(_).id,newParentId:B||null}),N(_,null),N(x,null)}function w(v,i){const S=f.content.nodes.get(v);return!S||!S.parent?!1:S.parent===i?!0:w(S.parent,i)}function m(v){return v.type==="folder"?s(g).has(v.id)?"📂":"📁":v.type==="module"?"📚":"📄"}var b=Ut(),y=n(b),P=u(n(y),2);{var C=v=>{var i=Rt(),S=n(i);S.__click=[jt,oe];var B=u(S,2);B.__click=[Et,oe],a(i),p(v,i)};D(P,v=>{r()&&v(C)})}a(y);var W=u(y,2),ee=n(W);Qe(ee,17,()=>s(M)(),v=>v.id,(v,i)=>{t(v,()=>s(i),()=>0)});var Y=u(ee,2);{var X=v=>{var i=Ot(),S=u(n(i),2);{var B=R=>{var h=Nt();h.__click=[Bt,oe],p(R,h)};D(S,R=>{r()&&R(B)})}a(i),p(v,i)};D(Y,v=>{s(M)().length===0&&v(X)})}a(W),a(b),p(l,b),Je()}Ye(["click"]);var Vt=Ge('<path fill="none"></path>'),Ft=(l,e,t)=>e(s(t).id),Kt=(l,e,t)=>{(l.key==="Enter"||l.key===" ")&&e(s(t).id)},Ht=Ge('<foreignObject width="200" height="100" class="tooltip svelte-tgb1zn"><div class="tooltip-content svelte-tgb1zn"><h4 class="svelte-tgb1zn"> </h4> <p class="svelte-tgb1zn"> </p></div></foreignObject>'),Qt=Ge('<g class="node-group"><circle role="button" tabindex="0"></circle><text text-anchor="middle"> </text><!></g>'),Wt=A('<div class="knowledge-map svelte-tgb1zn"><svg class="map-svg svelte-tgb1zn"><defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#6b7280"></polygon></marker></defs><!><!></svg> <div class="legend svelte-tgb1zn"><div class="legend-item svelte-tgb1zn"><div class="legend-color svelte-tgb1zn"></div> <span>Completed</span></div> <div class="legend-item svelte-tgb1zn"><div class="legend-color svelte-tgb1zn"></div> <span>Current</span></div> <div class="legend-item svelte-tgb1zn"><div class="legend-color svelte-tgb1zn"></div> <span>Available</span></div> <div class="legend-item svelte-tgb1zn"><div class="legend-color svelte-tgb1zn"></div> <span>Locked</span></div></div></div>');function Rs(l,e){We(e,!0);const t=tt();let o=Pe(e,"currentContent",3,null),d=Pe(e,"width",3,800),r=Pe(e,"height",3,600),g,_=ce(Be([])),x=ce(Be([])),M=ce(null),L=ce(Be(o()));const T=20,ue=2,oe={completed:"#22c55e",current:"#3b82f6",available:"#f59e0b",locked:"#6b7280"};ot(()=>{he()});function he(){N(_,e.modules.map((c,k)=>{const I=Q(c.id),V=k/e.modules.length*2*Math.PI,z=Math.min(d(),r())*.3,te=d()/2,ae=r()/2;return{id:c.id,contentId:c.id,title:c.title,type:"concept",status:I,position:{x:te+Math.cos(V)*z,y:ae+Math.sin(V)*z},size:T,color:oe[I]}}),!0),N(x,[],!0);let h=0;for(const c of e.modules){for(const k of c.metadata.prerequisites)e.modules.some(I=>I.id===k)&&s(x).push({id:`conn-${h++}`,sourceId:k,targetId:c.id,type:"prerequisite",strength:1,style:"solid",color:"#6b7280"});for(const k of e.modules)if(c.id!==k.id){const I=c.metadata.tags.filter(V=>k.metadata.tags.includes(V));if(I.length>=2){const V=I.length/Math.max(c.metadata.tags.length,k.metadata.tags.length);s(x).push({id:`conn-${h++}`,sourceId:c.id,targetId:k.id,type:"related",strength:V,style:"dashed",color:"#94a3b8"})}}}G()}function Q(h){if(e.completedContent.has(h))return"completed";if(h===o())return"in-progress";const c=e.modules.find(I=>I.id===h);return c&&c.metadata.prerequisites.every(I=>e.completedContent.has(I))?"available":"locked"}function G(){for(let V=0;V<100;V++)for(const z of s(_)){let te=0,ae=0;for(const se of s(_)){if(z.id===se.id)continue;const Z=z.position.x-se.position.x,U=z.position.y-se.position.y,F=Math.sqrt(Z*Z+U*U);if(F>0){const $=1e3/(F*F);te+=Z/F*$,ae+=U/F*$}}for(const se of s(x)){let Z;if(se.sourceId===z.id?Z=s(_).find(U=>U.id===se.targetId):se.targetId===z.id&&(Z=s(_).find(U=>U.id===se.sourceId)),Z){const U=Z.position.x-z.position.x,F=Z.position.y-z.position.y,$=Math.sqrt(U*U+F*F);if($>0){const me=.1*se.strength;te+=U/$*me,ae+=F/$*me}}}z.position.x+=te*.9,z.position.y+=ae*.9,z.position.x=Math.max(T,Math.min(d()-T,z.position.x)),z.position.y=Math.max(T,Math.min(r()-T,z.position.y))}}function re(h){N(L,h,!0),t("nodeclick",h)}function ie(h){N(M,h,!0),t("nodehover",h)}function de(h){const c=s(_).find($=>$.id===h.sourceId),k=s(_).find($=>$.id===h.targetId);if(!c||!k)return"";const I=k.position.x-c.position.x,V=k.position.y-c.position.y,z=Math.sqrt(I*I+V*V);if(z===0)return"";const te=I/z,ae=V/z,se=c.position.x+te*T,Z=c.position.y+ae*T,U=k.position.x-te*T,F=k.position.y-ae*T;return`M ${se} ${Z} L ${U} ${F}`}function w(h){const c=e.modules.find(k=>k.id===h.id);return c?c.title:h.title}function m(h){const c=e.modules.find(V=>V.id===h.id);if(!c)return"";const k=Q(h.id),I={completed:"Completed","in-progress":"In Progress",available:"Available",locked:"Locked"}[k];return`${c.description}
Status: ${I}
Difficulty: ${c.metadata.difficulty}/5
Tags: ${c.metadata.tags.join(", ")}`}var b=Wt(),y=n(b),P=u(n(y));Qe(P,17,()=>s(x),h=>h.id,(h,c)=>{var k=Vt();H(I=>{O(k,"d",I),O(k,"stroke",s(c).color),O(k,"stroke-width",ue*s(c).strength),O(k,"stroke-dasharray",s(c).style==="dashed"?"5,5":s(c).style==="dotted"?"2,2":"none"),O(k,"marker-end",s(c).type==="prerequisite"?"url(#arrowhead)":"none"),O(k,"opacity",s(M)&&(s(M)===s(c).sourceId||s(M)===s(c).targetId)?1:.6)},[()=>de(s(c))]),p(h,k)});var C=u(P);Qe(C,17,()=>s(_),h=>h.id,(h,c)=>{var k=Qt(),I=n(k);let V;I.__click=[Ft,re,c],I.__keydown=[Kt,re,c];var z=u(I);let te;var ae=n(z,!0);a(z);var se=u(z);{var Z=U=>{var F=Ht(),$=n(F),me=n($),De=n(me,!0);a(me);var K=u(me,2),J=n(K,!0);a(K),a($),a(F),H((le,ye)=>{O(F,"x",s(c).position.x+s(c).size+10),O(F,"y",s(c).position.y-30),q(De,le),q(J,ye)},[()=>w(s(c)),()=>m(s(c))]),p(U,F)};D(se,U=>{s(M)===s(c).id&&U(Z)})}a(k),H((U,F,$)=>{O(I,"cx",s(c).position.x),O(I,"cy",s(c).position.y),O(I,"r",s(c).size),O(I,"fill",s(c).color),O(I,"stroke",s(L)===s(c).id?"#1f2937":"white"),O(I,"stroke-width",s(L)===s(c).id?3:2),V=Te(I,0,"node-circle svelte-tgb1zn",null,V,U),O(z,"x",s(c).position.x),O(z,"y",s(c).position.y+s(c).size+15),te=Te(z,0,"node-label svelte-tgb1zn",null,te,F),q(ae,$)},[()=>({hovered:s(M)===s(c).id}),()=>({selected:s(L)===s(c).id}),()=>w(s(c)).length>15?w(s(c)).substring(0,15)+"...":w(s(c))]),Ee("mouseenter",I,()=>ie(s(c).id)),Ee("mouseleave",I,()=>ie(null)),p(h,k)}),a(y),_t(y,h=>g=h,()=>g);var W=u(y,2),ee=n(W),Y=n(ee);Me(2),a(ee);var X=u(ee,2),v=n(X);Me(2),a(X);var i=u(X,2),S=n(i);Me(2),a(i);var B=u(i,2),R=n(B);Me(2),a(B),a(W),a(b),H(()=>{je(b,`width: ${d()??""}px; height: ${r()??""}px;`),O(y,"width",d()),O(y,"height",r()),je(Y,`background-color: ${oe.completed}`),je(v,`background-color: ${oe.current}`),je(S,`background-color: ${oe.available}`),je(R,`background-color: ${oe.locked}`)}),p(l,b),Je()}Ye(["click","keydown"]);const Jt="InteractiveKnowledgeSystem",Gt=3,Xt={modules:{name:"modules",keyPath:"id",indexes:[{name:"title",keyPath:"title",unique:!1},{name:"author",keyPath:"metadata.author",unique:!1},{name:"tags",keyPath:"metadata.tags",unique:!1,multiEntry:!0},{name:"difficulty",keyPath:"metadata.difficulty",unique:!1},{name:"created",keyPath:"metadata.created",unique:!1}]},progress:{name:"progress",keyPath:["userId","moduleId"],indexes:[{name:"userId",keyPath:"userId",unique:!1},{name:"moduleId",keyPath:"moduleId",unique:!1},{name:"status",keyPath:"status",unique:!1},{name:"lastAccessed",keyPath:"lastAccessed",unique:!1}]},paths:{name:"paths",keyPath:"id",indexes:[{name:"name",keyPath:"name",unique:!1},{name:"difficulty",keyPath:"difficulty",unique:!1}]},settings:{name:"settings",keyPath:"id",indexes:[]},streaks:{name:"streaks",keyPath:"userId",indexes:[{name:"currentStreak",keyPath:"currentStreak",unique:!1},{name:"lastActivityDate",keyPath:"lastActivityDate",unique:!1}]},achievements:{name:"achievements",keyPath:"id",indexes:[{name:"userId",keyPath:"userId",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"earnedAt",keyPath:"earnedAt",unique:!1}]},links:{name:"links",keyPath:"id",indexes:[{name:"sourceId",keyPath:"sourceId",unique:!1},{name:"targetId",keyPath:"targetId",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"strength",keyPath:"strength",unique:!1},{name:"created",keyPath:"metadata.created",unique:!1},{name:"automatic",keyPath:"metadata.automatic",unique:!1}]},versions:{name:"versions",keyPath:"id",indexes:[{name:"entityType",keyPath:"entityType",unique:!1},{name:"entityId",keyPath:"entityId",unique:!1},{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"entityVersion",keyPath:["entityId","version"],unique:!0}]},offline_queue:{name:"offline_queue",keyPath:"id",indexes:[{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"entity",keyPath:"entity",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"priority",keyPath:"priority",unique:!1}]},sync_conflicts:{name:"sync_conflicts",keyPath:"id",indexes:[{name:"operationId",keyPath:"operationId",unique:!1},{name:"conflictType",keyPath:"conflictType",unique:!1},{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"resolved",keyPath:"resolved",unique:!1}]},web_sources:{name:"web_sources",keyPath:"id",indexes:[{name:"url",keyPath:"url",unique:!1},{name:"domain",keyPath:"domain",unique:!1},{name:"status",keyPath:"status",unique:!1},{name:"importDate",keyPath:"importDate",unique:!1},{name:"lastChecked",keyPath:"lastChecked",unique:!1},{name:"category",keyPath:"metadata.category",unique:!1},{name:"tags",keyPath:"metadata.tags",unique:!1,multiEntry:!0},{name:"author",keyPath:"metadata.author",unique:!1},{name:"timesReferenced",keyPath:"usage.timesReferenced",unique:!1}]}};class it{db=null;initPromise=null;get available(){return typeof window<"u"&&typeof window.indexedDB<"u"}async init(){return this.initPromise?this.initPromise:this.available?(this.initPromise=new Promise((e,t)=>{const o=setTimeout(()=>{t(new Error("Database initialization timeout"))},5e3),d=window.indexedDB.open(Jt,Gt);d.onerror=()=>{clearTimeout(o),t(new Error(`Failed to open database: ${d.error?.message}`))},d.onsuccess=()=>{clearTimeout(o),this.db=d.result,e()},d.onupgradeneeded=r=>{const g=r.target.result;this.createObjectStores(g)}}),this.initPromise):(this.initPromise=Promise.resolve(),this.initPromise)}createObjectStores(e){Object.values(Xt).forEach(t=>{if(!e.objectStoreNames.contains(t.name)){const o=e.createObjectStore(t.name,{keyPath:t.keyPath});t.indexes.forEach(d=>{const r=Array.isArray(d.keyPath)?[...d.keyPath]:d.keyPath,g={unique:d.unique};"multiEntry"in d&&(g.multiEntry=d.multiEntry||!1),o.createIndex(d.name,r,g)})}})}async ensureInitialized(){if(!this.available)throw new Error("IndexedDB is not available in this environment");if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async get(e,t){if(!this.available)return;const o=await this.ensureInitialized();return new Promise((d,r)=>{const x=o.transaction([e],"readonly").objectStore(e).get(t);x.onsuccess=()=>d(x.result),x.onerror=()=>r(x.error)})}async getAll(e,t,o){if(!this.available)return[];const d=await this.ensureInitialized();return new Promise((r,g)=>{const M=d.transaction([e],"readonly").objectStore(e).getAll(t,o);M.onsuccess=()=>r(M.result),M.onerror=()=>g(M.error)})}async add(e,t,o){if(!this.available)return;const d=await this.ensureInitialized();return new Promise((r,g)=>{const _=d.transaction([e,"versions"],"readwrite"),x=_.objectStore(e),M=_.objectStore("versions"),L=x.add(t);L.onsuccess=()=>{if(this.shouldVersion(e)){const T=this.createVersionRecord(e,t,o);M.add(T)}},_.oncomplete=()=>r(),_.onerror=()=>g(_.error)})}async put(e,t,o){if(!this.available)return;const d=await this.ensureInitialized();return new Promise((r,g)=>{const _=d.transaction([e,"versions"],"readwrite"),x=_.objectStore(e),M=_.objectStore("versions"),L=x.put(t);L.onsuccess=()=>{if(this.shouldVersion(e)){const T=this.createVersionRecord(e,t,o);M.add(T)}},_.oncomplete=()=>r(),_.onerror=()=>g(_.error)})}async delete(e,t){if(!this.available)return;const o=await this.ensureInitialized();return new Promise((d,r)=>{const g=o.transaction([e],"readwrite");g.objectStore(e).delete(t),g.oncomplete=()=>d(),g.onerror=()=>r(g.error)})}async searchByIndex(e,t,o,d){if(!this.available)return[];const r=await this.ensureInitialized();return new Promise((g,_)=>{const T=r.transaction([e],"readonly").objectStore(e).index(t).getAll(o,d);T.onsuccess=()=>g(T.result),T.onerror=()=>_(T.error)})}async getVersionHistory(e,t){if(!this.available)return[];const o=await this.ensureInitialized();return new Promise((d,r)=>{const M=o.transaction(["versions"],"readonly").objectStore("versions").index("entityId").getAll(e);M.onsuccess=()=>{const L=M.result.filter(T=>T.entityType===t);L.sort((T,ue)=>ue.timestamp.getTime()-T.timestamp.getTime()),d(L)},M.onerror=()=>r(M.error)})}async getVersion(e,t){if(!this.available)return;const o=await this.ensureInitialized();return new Promise((d,r)=>{const M=o.transaction(["versions"],"readonly").objectStore("versions").index("entityVersion").get([e,t]);M.onsuccess=()=>d(M.result),M.onerror=()=>r(M.error)})}shouldVersion(e){return["modules","paths","settings"].includes(e)}createVersionRecord(e,t,o){const d=this.getEntityId(t),r=this.getEntityVersion(t);return{id:`${d}_v${r}_${Date.now()}`,entityType:e==="modules"?"module":e==="paths"?"path":"settings",entityId:d,version:r,data:structuredClone(t),timestamp:new Date,changeDescription:o}}getEntityId(e){return e.id||e.userId||"unknown"}getEntityVersion(e){return e.metadata?.version||e.version||1}close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const fe=new it,Bs=Object.freeze(Object.defineProperty({__proto__:null,IndexedDBStorage:it,storage:fe},Symbol.toStringTag,{value:"Module"}));var Yt=Ge('<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'),Zt=Ge('<svg class="w-4 h-4 text-blue-600 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),$t=A('<div class="w-2 h-2 bg-gray-400 rounded-full"></div>'),es=A('<div><svg class="absolute inset-0 w-full h-full transform -rotate-90" viewBox="0 0 36 36"><path class="stroke-gray-200" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path><path stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path></svg> <div class="relative z-10 flex items-center justify-center"><!></div></div>'),ts=A('<span class="text-sm text-gray-500"> </span>'),ss=A('<div class="w-full"><div class="flex justify-between items-center mb-1"><span class="text-sm font-medium text-gray-700"> </span> <!></div> <div class="w-full bg-gray-200 rounded-full h-2"><div></div></div></div>'),rs=A("<span><!> <!></span>"),as=A("<div> </div>"),ns=A("<div> </div>"),os=A("<div> </div>"),is=A('<div class="mt-2 text-xs text-gray-600 space-y-1"><!> <!> <!></div>'),ds=A("<!> <!>",1);function dt(l,e){We(e,!0);let t=Pe(e,"showDetails",3,!1),o=Pe(e,"size",3,"medium"),d=Pe(e,"variant",3,"circular");const r=He(()=>()=>{if(!e.progress)return 0;switch(e.progress.status){case"completed":return 100;case"in-progress":return 50;case"not-started":default:return 0}}),g=He(()=>()=>{if(!e.progress)return"gray";switch(e.progress.status){case"completed":return"green";case"in-progress":return"blue";case"not-started":default:return"gray"}}),_=Q=>{if(Q<60)return`${Q}m`;const G=Math.floor(Q/60),re=Q%60;return re>0?`${G}h ${re}m`:`${G}h`},x=He(()=>()=>{switch(o()){case"small":return"w-6 h-6 text-xs";case"large":return"w-16 h-16 text-lg";case"medium":default:return"w-10 h-10 text-sm"}});var M=ds(),L=_e(M);{var T=Q=>{var G=es(),re=n(G),ie=u(n(re));a(re);var de=u(re,2),w=n(de);{var m=y=>{var P=Yt();p(y,P)},b=y=>{var P=Re(),C=_e(P);{var W=Y=>{var X=Zt();p(Y,X)},ee=Y=>{var X=$t();p(Y,X)};D(C,Y=>{e.progress?.status==="in-progress"?Y(W):Y(ee,!1)},!0)}p(y,P)};D(w,y=>{e.progress?.status==="completed"?y(m):y(b,!1)})}a(de),a(G),H((y,P,C)=>{Te(G,1,`relative inline-flex items-center justify-center ${y??""}`,"svelte-ohjugr"),Te(ie,0,`stroke-${P??""}-500 transition-all duration-300`,"svelte-ohjugr"),O(ie,"stroke-dasharray",`${C??""}, 100`)},[()=>s(x)(),()=>s(g)(),()=>s(r)()]),p(Q,G)},ue=Q=>{var G=Re(),re=_e(G);{var ie=w=>{var m=ss(),b=n(m),y=n(b),P=n(y,!0);a(y);var C=u(y,2);{var W=X=>{var v=ts(),i=n(v);a(v),H(()=>q(i,`${e.progress.score??""}%`)),p(X,v)};D(C,X=>{e.progress?.score!==void 0&&X(W)})}a(b);var ee=u(b,2),Y=n(ee);a(ee),a(m),H((X,v)=>{q(P,e.progress?.status==="completed"?"Completed":e.progress?.status==="in-progress"?"In Progress":"Not Started"),Te(Y,1,`bg-${X??""}-500 h-2 rounded-full transition-all duration-300`,"svelte-ohjugr"),je(Y,`width: ${v??""}%`)},[()=>s(g)(),()=>s(r)()]),p(w,m)},de=w=>{var m=Re(),b=_e(m);{var y=P=>{var C=rs(),W=n(C);{var ee=i=>{var S=Ve("✓ Completed");p(i,S)},Y=i=>{var S=Re(),B=_e(S);{var R=c=>{var k=Ve("⏳ In Progress");p(c,k)},h=c=>{var k=Ve("○ Not Started");p(c,k)};D(B,c=>{e.progress?.status==="in-progress"?c(R):c(h,!1)},!0)}p(i,S)};D(W,i=>{e.progress?.status==="completed"?i(ee):i(Y,!1)})}var X=u(W,2);{var v=i=>{var S=Ve();H(()=>q(S,`(${e.progress.score??""}%)`)),p(i,S)};D(X,i=>{e.progress?.score!==void 0&&i(v)})}a(C),H((i,S)=>Te(C,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${i??""}-100 text-${S??""}-800`,"svelte-ohjugr"),[()=>s(g)(),()=>s(g)()]),p(P,C)};D(b,P=>{d()==="badge"&&P(y)},!0)}p(w,m)};D(re,w=>{d()==="linear"?w(ie):w(de,!1)},!0)}p(Q,G)};D(L,Q=>{d()==="circular"?Q(T):Q(ue,!1)})}var oe=u(L,2);{var he=Q=>{var G=is(),re=n(G);{var ie=y=>{var P=as(),C=n(P);a(P),H(W=>q(C,`Time spent: ${W??""}`),[()=>_(e.progress.timeSpent)]),p(y,P)};D(re,y=>{e.progress.timeSpent>0&&y(ie)})}var de=u(re,2);{var w=y=>{var P=ns(),C=n(P);a(P),H(()=>q(C,`Attempts: ${e.progress.attempts??""}`)),p(y,P)};D(de,y=>{e.progress.attempts>0&&y(w)})}var m=u(de,2);{var b=y=>{var P=os(),C=n(P);a(P),H(W=>q(C,`Last accessed: ${W??""}`),[()=>e.progress.lastAccessed.toLocaleDateString()]),p(y,P)};D(m,y=>{e.progress.lastAccessed&&y(b)})}a(G),p(Q,G)};D(oe,Q=>{t()&&e.progress&&Q(he)})}p(l,M),Je()}class ls{async updateProgress(e){const t={...e,lastAccessed:new Date};await fe.put("progress",t)}async getProgress(e,t){return await fe.get("progress",[e,t])}async getUserProgress(e){return await fe.searchByIndex("progress","userId",e)}async getModuleProgress(e){return await fe.searchByIndex("progress","moduleId",e)}async getCompletedModules(e){return(await this.getUserProgress(e)).filter(o=>o.status==="completed")}async getInProgressModules(e){return(await this.getUserProgress(e)).filter(o=>o.status==="in-progress")}async getBookmarkedModules(e){return(await this.getUserProgress(e)).filter(o=>o.bookmarked)}async completeModule(e,t,o){const d=await this.getProgress(e,t),r={userId:e,moduleId:t,status:"completed",score:o,timeSpent:d?.timeSpent||0,lastAccessed:new Date,attempts:(d?.attempts||0)+1,bookmarked:d?.bookmarked||!1,notes:d?.notes||""};await this.updateProgress(r)}async startModule(e,t){const o=await this.getProgress(e,t),d={userId:e,moduleId:t,status:"in-progress",timeSpent:o?.timeSpent||0,lastAccessed:new Date,attempts:o?.attempts||0,bookmarked:o?.bookmarked||!1,notes:o?.notes||""};await this.updateProgress(d)}async addTimeSpent(e,t,o){const d=await this.getProgress(e,t);d&&(d.timeSpent+=o,await this.updateProgress(d))}async toggleBookmark(e,t){const d=await this.getProgress(e,t)||{userId:e,moduleId:t,status:"not-started",timeSpent:0,lastAccessed:new Date,attempts:0,bookmarked:!1,notes:""};return d.bookmarked=!d.bookmarked,await this.updateProgress(d),d.bookmarked}async updateNotes(e,t,o){const r=await this.getProgress(e,t)||{userId:e,moduleId:t,status:"not-started",timeSpent:0,lastAccessed:new Date,attempts:0,bookmarked:!1,notes:""};r.notes=o,await this.updateProgress(r)}async getRecentlyAccessed(e,t=10){return(await this.getUserProgress(e)).sort((d,r)=>r.lastAccessed.getTime()-d.lastAccessed.getTime()).slice(0,t)}async deleteProgress(e,t){await fe.delete("progress",[e,t])}async deleteUserProgress(e){const t=await this.getUserProgress(e);for(const o of t)await fe.delete("progress",[o.userId,o.moduleId])}async getProgressStats(e){const t=await this.getUserProgress(e),o=t.filter(L=>L.status==="completed"),d=t.filter(L=>L.status==="in-progress"),r=t.reduce((L,T)=>L+T.timeSpent,0),g=o.length>0?o.reduce((L,T)=>L+(T.score||0),0)/o.length:0,_=t.length>0?o.length/t.length*100:0,x=await this.getLearningStreak(e),M=t.length>0?new Date(Math.max(...t.map(L=>L.lastAccessed.getTime()))):new Date;return{totalModules:t.length,completedModules:o.length,inProgressModules:d.length,completionRate:_,averageScore:g,totalTimeSpent:r,currentStreak:x.currentStreak,longestStreak:x.longestStreak,lastActivityDate:M}}async getLearningStreak(e){let t=await fe.get("streaks",e);return t||(t={userId:e,currentStreak:0,longestStreak:0,lastActivityDate:new Date,streakStartDate:new Date},await fe.add("streaks",t)),t}async updateLearningStreak(e){const t=await this.getLearningStreak(e),o=new Date,d=new Date(t.lastActivityDate),r=o.toDateString()!==d.toDateString(),g=Math.floor((o.getTime()-d.getTime())/(1e3*60*60*24));return r&&(g===1?(t.currentStreak+=1,t.currentStreak>t.longestStreak&&(t.longestStreak=t.currentStreak)):g>1&&(t.currentStreak=1,t.streakStartDate=o)),t.lastActivityDate=o,await fe.put("streaks",t),t}async getUserAchievements(e){return await fe.searchByIndex("achievements","userId",e)}async awardAchievement(e){await fe.add("achievements",e)}async checkAndAwardAchievements(e){const t=await this.getProgressStats(e),o=await this.getUserAchievements(e),d=[];if(t.completedModules>=1&&!o.some(r=>r.type==="completion"&&r.id==="first-completion")){const r={id:"first-completion",userId:e,type:"completion",title:"First Steps",description:"Completed your first module!",earnedAt:new Date,metadata:{modulesCompleted:t.completedModules}};await this.awardAchievement(r),d.push(r)}if(t.currentStreak>=7&&!o.some(r=>r.type==="streak"&&r.id==="week-streak")){const r={id:"week-streak",userId:e,type:"streak",title:"Week Warrior",description:"Maintained a 7-day learning streak!",earnedAt:new Date,metadata:{streakLength:t.currentStreak}};await this.awardAchievement(r),d.push(r)}if(t.averageScore>=90&&t.completedModules>=5&&!o.some(r=>r.type==="score"&&r.id==="high-achiever")){const r={id:"high-achiever",userId:e,type:"score",title:"High Achiever",description:"Maintained 90%+ average score across 5+ modules!",earnedAt:new Date,metadata:{averageScore:t.averageScore,modulesCompleted:t.completedModules}};await this.awardAchievement(r),d.push(r)}return d}}const we=new ls;var cs=A('<div class="bg-red-50 border border-red-200 rounded-md p-4 mb-6"><div class="flex"><svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> <div class="ml-3"><h3 class="text-sm font-medium text-red-800">Error loading progress</h3> <p class="text-sm text-red-700 mt-1"> </p></div></div></div>'),us=A('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <span class="ml-3 text-gray-600">Loading progress data...</span></div>'),vs=A('<div class="flex items-center p-3 bg-white rounded-md shadow-sm"><div class="text-2xl mr-3"> </div> <div class="flex-1"><p class="text-sm font-medium text-gray-900"> </p> <p class="text-xs text-gray-600"> </p> <p class="text-xs text-gray-500 mt-1"> </p></div></div>'),gs=A('<div class="space-y-3"></div>'),ms=A('<div class="text-center py-8"><div class="text-4xl mb-2">🏆</div> <p class="text-sm text-gray-600">No achievements yet</p> <p class="text-xs text-gray-500">Complete modules to earn your first achievement!</p></div>'),ps=A('<div class="mt-6 text-center"><p class="text-sm text-gray-600"> </p></div>'),fs=A('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-blue-600">Completion Rate</p> <p class="text-2xl font-bold text-blue-900"> </p> <p class="text-xs text-blue-700"> </p></div> <div class="flex-shrink-0"><!></div></div></div> <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-green-600">Average Score</p> <p class="text-2xl font-bold text-green-900"> </p> <p class="text-xs text-green-700">Across completed modules</p></div> <div class="text-3xl">⭐</div></div></div> <div class="bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-lg"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-orange-600">Current Streak</p> <p class="text-2xl font-bold text-orange-900"> </p> <p class="text-xs text-orange-700"> </p></div> <div class="text-3xl">🔥</div></div></div> <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-purple-600">Time Spent</p> <p class="text-2xl font-bold text-purple-900"> </p> <p class="text-xs text-purple-700">Total learning time</p></div> <div class="text-3xl">⏰</div></div></div></div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-gray-50 p-6 rounded-lg"><h3 class="text-lg font-semibold text-gray-900 mb-4">Module Status</h3> <div class="space-y-4"><div class="flex items-center justify-between"><div class="flex items-center"><div class="w-4 h-4 bg-green-500 rounded-full mr-3"></div> <span class="text-sm font-medium text-gray-700">Completed</span></div> <span class="text-sm font-bold text-gray-900"> </span></div> <div class="flex items-center justify-between"><div class="flex items-center"><div class="w-4 h-4 bg-blue-500 rounded-full mr-3"></div> <span class="text-sm font-medium text-gray-700">In Progress</span></div> <span class="text-sm font-bold text-gray-900"> </span></div> <div class="flex items-center justify-between"><div class="flex items-center"><div class="w-4 h-4 bg-gray-400 rounded-full mr-3"></div> <span class="text-sm font-medium text-gray-700">Not Started</span></div> <span class="text-sm font-bold text-gray-900"> </span></div></div></div> <div class="bg-gray-50 p-6 rounded-lg"><h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Achievements</h3> <!></div></div> <!>',1),_s=A('<div class="progress-dashboard p-6 bg-white rounded-lg shadow-sm svelte-w1iaeq"><div class="flex items-center justify-between mb-6"><h2 class="text-2xl font-bold text-gray-900">Learning Progress</h2> <button class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors"><!></button></div> <!> <!></div>');function Ns(l,e){We(e,!0);let t=ce(null),o=ce(Be([])),d=ce(null),r=ce(!0),g=ce(null);const _=async()=>{try{N(r,!0),N(g,null);const[m,b,y]=await Promise.all([we.getProgressStats(e.userId),we.getUserAchievements(e.userId),we.getLearningStreak(e.userId)]);N(t,m,!0),N(o,b.sort((P,C)=>C.earnedAt.getTime()-P.earnedAt.getTime()),!0),N(d,y,!0)}catch(m){N(g,m instanceof Error?m.message:"Failed to load progress data",!0),console.error("Error loading progress data:",m)}finally{N(r,!1)}},x=m=>{if(m<60)return`${m} min`;const b=Math.floor(m/60),y=m%60;if(b<24)return y>0?`${b}h ${y}m`:`${b}h`;const P=Math.floor(b/24),C=b%24;return C>0?`${P}d ${C}h`:`${P}d`},M=m=>{switch(m){case"completion":return"🎯";case"streak":return"🔥";case"score":return"⭐";case"time":return"⏰";case"milestone":return"🏆";default:return"🎉"}};ot(()=>{_()});var L=_s(),T=n(L),ue=u(n(T),2);ue.__click=_;var oe=n(ue);{var he=m=>{var b=Ve("Loading...");p(m,b)},Q=m=>{var b=Ve("Refresh");p(m,b)};D(oe,m=>{s(r)?m(he):m(Q,!1)})}a(ue),a(T);var G=u(T,2);{var re=m=>{var b=cs(),y=n(b),P=u(n(y),2),C=u(n(P),2),W=n(C,!0);a(C),a(P),a(y),a(b),H(()=>q(W,s(g))),p(m,b)};D(G,m=>{s(g)&&m(re)})}var ie=u(G,2);{var de=m=>{var b=us();p(m,b)},w=m=>{var b=Re(),y=_e(b);{var P=C=>{var W=fs(),ee=_e(W),Y=n(ee),X=n(Y),v=n(X),i=u(n(v),2),S=n(i);a(i);var B=u(i,2),R=n(B);a(B),a(v);var h=u(v,2),c=n(h);{let ge=He(()=>({userId:e.userId,moduleId:"overview",status:s(t).completionRate===100?"completed":s(t).completionRate>0?"in-progress":"not-started",timeSpent:0,lastAccessed:new Date,attempts:0,bookmarked:!1,notes:""}));dt(c,{get progress(){return s(ge)},size:"large"})}a(h),a(X),a(Y);var k=u(Y,2),I=n(k),V=n(I),z=u(n(V),2),te=n(z);a(z),Me(2),a(V),Me(2),a(I),a(k);var ae=u(k,2),se=n(ae),Z=n(se),U=u(n(Z),2),F=n(U);a(U);var $=u(U,2),me=n($);a($),a(Z),Me(2),a(se),a(ae);var De=u(ae,2),K=n(De),J=n(K),le=u(n(J),2),ye=n(le,!0);a(le),Me(2),a(J),Me(2),a(K),a(De),a(ee);var Se=u(ee,2),ve=n(Se),ke=u(n(ve),2),Ce=n(ke),Ne=u(n(Ce),2),j=n(Ne,!0);a(Ne),a(Ce);var E=u(Ce,2),ne=u(n(E),2),xe=n(ne,!0);a(ne),a(E);var Ae=u(E,2),qe=u(n(Ae),2),ze=n(qe,!0);a(qe),a(Ae),a(ke),a(ve);var pe=u(ve,2),Ie=u(n(pe),2);{var Xe=ge=>{var be=gs();Qe(be,21,()=>s(o).slice(0,5),ht,(Oe,Ue)=>{var Fe=vs(),Ke=n(Fe),ut=n(Ke,!0);a(Ke);var st=u(Ke,2),$e=n(st),vt=n($e,!0);a($e);var et=u($e,2),gt=n(et,!0);a(et);var rt=u(et,2),mt=n(rt,!0);a(rt),a(st),a(Fe),H((pt,ft)=>{q(ut,pt),q(vt,s(Ue).title),q(gt,s(Ue).description),q(mt,ft)},[()=>M(s(Ue).type),()=>s(Ue).earnedAt.toLocaleDateString()]),p(Oe,Fe)}),a(be),p(ge,be)},Ze=ge=>{var be=ms();p(ge,be)};D(Ie,ge=>{s(o).length>0?ge(Xe):ge(Ze,!1)})}a(pe),a(Se);var lt=u(Se,2);{var ct=ge=>{var be=ps(),Oe=n(be),Ue=n(Oe);a(Oe),a(be),H((Fe,Ke)=>q(Ue,`Last activity: ${Fe??""} at ${Ke??""}`),[()=>s(t).lastActivityDate.toLocaleDateString(),()=>s(t).lastActivityDate.toLocaleTimeString()]),p(ge,be)};D(lt,ge=>{s(t).lastActivityDate&&ge(ct)})}H((ge,be,Oe)=>{q(S,`${ge??""}%`),q(R,`${s(t).completedModules??""} of ${s(t).totalModules??""} modules`),q(te,`${be??""}%`),q(F,`${s(t).currentStreak??""} days`),q(me,`Longest: ${s(t).longestStreak??""} days`),q(ye,Oe),q(j,s(t).completedModules),q(xe,s(t).inProgressModules),q(ze,s(t).totalModules-s(t).completedModules-s(t).inProgressModules)},[()=>s(t).completionRate.toFixed(1),()=>s(t).averageScore.toFixed(1),()=>x(s(t).totalTimeSpent)]),p(C,W)};D(y,C=>{s(t)&&C(P)},!0)}p(m,b)};D(ie,m=>{s(r)?m(de):m(w,!1)})}a(L),H(()=>ue.disabled=s(r)),p(l,L),Je()}Ye(["click"]);const hs=async(l,e,t,o,d,r)=>{try{await we.startModule(e.userId,e.moduleId),await t(),o()&&d(),await we.updateLearningStreak(e.userId)}catch(g){N(r,g instanceof Error?g.message:"Failed to start module",!0),console.error("Error starting module:",g)}},ys=async(l,e,t,o,d)=>{try{const r=await we.toggleBookmark(e.userId,e.moduleId);s(t)&&(s(t).bookmarked=r,f.progress.userProgress.set(e.moduleId,s(t)),o("progressupdate",s(t)))}catch(r){N(d,r instanceof Error?r.message:"Failed to toggle bookmark",!0),console.error("Error toggling bookmark:",r)}};var xs=A('<div class="bg-red-50 border border-red-200 rounded-md p-3 mb-4"><div class="flex"><svg class="w-4 h-4 text-red-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> <div class="ml-2"><p class="text-sm text-red-700"> </p></div></div></div>'),bs=A('<div class="flex items-center justify-center py-4"><div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div> <span class="ml-2 text-sm text-gray-600">Loading progress...</span></div>'),ks=A('<p class="text-xs text-gray-600"> </p>'),ws=A('<span class="text-blue-600"> </span>'),Ps=A('<button class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 transition-colors">Start Learning</button>'),Ss=(l,e)=>e(),As=A('<button class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-green-700 transition-colors">Mark Complete</button>'),Is=A('<div class="text-xs text-green-600 mt-1"> </div>'),Ms=A('<div class="flex-1 bg-green-100 text-green-800 px-4 py-2 rounded-md text-sm font-medium text-center">✓ Completed <!></div>'),Ds=A('<div class="flex space-x-2"><!></div>'),qs=A('<div class="mt-3 pt-3 border-t border-gray-100"><p class="text-xs text-gray-500"> </p></div>'),Ts=A('<div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-3"><!> <div><p class="text-sm font-medium text-gray-900"> </p> <!></div></div> <div class="flex items-center space-x-2"><button class="p-1 rounded-md hover:bg-gray-100 transition-colors" type="button"><svg stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg></button></div></div> <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4"><div><span class="font-medium">Time spent:</span> <span class="ml-1"> <!></span></div> <div><span class="font-medium">Attempts:</span> <span class="ml-1"> </span></div></div> <!> <!>',1),Cs=A('<div class="progress-tracker bg-white border border-gray-200 rounded-lg p-4 svelte-w6vutz"><!> <!></div>');function Os(l,e){We(e,!0);const t=tt();let o=Pe(e,"autoTrackTime",3,!0),d=Pe(e,"showControls",3,!0),r=ce(null),g=ce(!0),_=ce(null),x=Be({startTime:null,intervalId:null,sessionTime:0});const M=async()=>{try{N(g,!0),N(_,null);const w=await we.getProgress(e.userId,e.moduleId);N(r,w||{userId:e.userId,moduleId:e.moduleId,status:"not-started",timeSpent:0,lastAccessed:new Date,attempts:0,bookmarked:!1,notes:""},!0),f.progress.userProgress.set(e.moduleId,s(r))}catch(w){N(_,w instanceof Error?w.message:"Failed to load progress",!0),console.error("Error loading progress:",w)}finally{N(g,!1)}},L=()=>{!o()||x.startTime||(x.startTime=new Date,x.intervalId=setInterval(()=>{x.startTime&&(x.sessionTime=Math.floor((Date.now()-x.startTime.getTime())/1e3/60))},6e4))},T=async()=>{if(!x.startTime||!s(r))return;const w=Math.floor((Date.now()-x.startTime.getTime())/1e3/60);x.intervalId&&(clearInterval(x.intervalId),x.intervalId=null),w>0&&(await we.addTimeSpent(e.userId,e.moduleId,w),s(r).timeSpent+=w,f.progress.userProgress.set(e.moduleId,s(r)),t("progressupdate",s(r))),x.startTime=null,x.sessionTime=0},ue=async w=>{try{await T(),await we.completeModule(e.userId,e.moduleId,w),await M(),f.progress.completedModules.add(e.moduleId);const m=await we.checkAndAwardAchievements(e.userId);for(const b of m)Le.addNotification({type:"success",message:`🎉 Achievement unlocked: ${b.title}!`})}catch(m){N(_,m instanceof Error?m.message:"Failed to complete module",!0),console.error("Error completing module:",m)}},oe=w=>{if(w<60)return`${w}m`;const m=Math.floor(w/60),b=w%60;return b>0?`${m}h ${b}m`:`${m}h`};yt(()=>(M(),o()&&setTimeout(()=>{s(r)?.status==="in-progress"&&L()},100),()=>{T()}));var he=Cs(),Q=n(he);{var G=w=>{var m=xs(),b=n(m),y=u(n(b),2),P=n(y),C=n(P,!0);a(P),a(y),a(b),a(m),H(()=>q(C,s(_))),p(w,m)};D(Q,w=>{s(_)&&w(G)})}var re=u(Q,2);{var ie=w=>{var m=bs();p(w,m)},de=w=>{var m=Re(),b=_e(m);{var y=P=>{var C=Ts(),W=_e(C),ee=n(W),Y=n(ee);dt(Y,{get progress(){return s(r)},size:"medium"});var X=u(Y,2),v=n(X),i=n(v,!0);a(v);var S=u(v,2);{var B=K=>{var J=ks(),le=n(J);a(J),H(()=>q(le,`Score: ${s(r).score??""}%`)),p(K,J)};D(S,K=>{s(r).score!==void 0&&K(B)})}a(X),a(ee);var R=u(ee,2),h=n(R);h.__click=[ys,e,r,t,_];var c=n(h);a(h),a(R),a(W);var k=u(W,2),I=n(k),V=u(n(I),2),z=n(V),te=u(z);{var ae=K=>{var J=ws(),le=n(J);a(J),H(()=>q(le,`(+${x.sessionTime??""}m this session)`)),p(K,J)};D(te,K=>{x.sessionTime>0&&K(ae)})}a(V),a(I);var se=u(I,2),Z=u(n(se),2),U=n(Z,!0);a(Z),a(se),a(k);var F=u(k,2);{var $=K=>{var J=Ds(),le=n(J);{var ye=ve=>{var ke=Ps();ke.__click=[hs,e,M,o,L,_],p(ve,ke)},Se=ve=>{var ke=Re(),Ce=_e(ke);{var Ne=E=>{var ne=As();ne.__click=[Ss,ue],p(E,ne)},j=E=>{var ne=Ms(),xe=u(n(ne));{var Ae=qe=>{var ze=Is(),pe=n(ze,!0);a(ze),H(Ie=>q(pe,Ie),[()=>s(r).completedAt.toLocaleDateString()]),p(qe,ze)};D(xe,qe=>{s(r).completedAt&&qe(Ae)})}a(ne),p(E,ne)};D(Ce,E=>{s(r).status==="in-progress"?E(Ne):E(j,!1)},!0)}p(ve,ke)};D(le,ve=>{s(r).status==="not-started"?ve(ye):ve(Se,!1)})}a(J),p(K,J)};D(F,K=>{d()&&K($)})}var me=u(F,2);{var De=K=>{var J=qs(),le=n(J),ye=n(le);a(le),a(J),H((Se,ve)=>q(ye,`Last accessed: ${Se??""} at ${ve??""}`),[()=>s(r).lastAccessed.toLocaleDateString(),()=>s(r).lastAccessed.toLocaleTimeString()]),p(K,J)};D(me,K=>{s(r).lastAccessed&&K(De)})}H(K=>{q(i,s(r).status==="completed"?"Completed":s(r).status==="in-progress"?"In Progress":"Not Started"),O(h,"title",s(r).bookmarked?"Remove bookmark":"Add bookmark"),O(h,"aria-label",s(r).bookmarked?"Remove bookmark":"Add bookmark"),O(h,"aria-pressed",s(r).bookmarked),Te(c,0,`w-4 h-4 ${s(r).bookmarked?"text-yellow-500 fill-current":"text-gray-400"}`),O(c,"fill",s(r).bookmarked?"currentColor":"none"),q(z,`${K??""} `),q(U,s(r).attempts)},[()=>oe(s(r).timeSpent)]),p(P,C)};D(b,P=>{s(r)&&P(y)},!0)}p(w,m)};D(re,w=>{s(g)?w(ie):w(de,!1)})}a(he),p(l,he),Je()}Ye(["click"]);export{Es as K,Os as P,Le as a,f as b,Ns as c,dt as d,Rs as e,Ls as f,js as g,Bs as i,we as p,fe as s};
