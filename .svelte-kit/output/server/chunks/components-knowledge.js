import{e as q,p as x,d as A,b as I,f as E,c as P,a as v,s as D}from"./vendor.js";import"clsx";import"@sveltejs/kit/internal";const r={user:{id:"",settings:null,isAuthenticated:!1},content:{nodes:new Map,currentNode:null,searchQuery:"",searchResults:[],isLoading:!1},progress:{completedModules:new Set,currentStreak:0,totalTimeSpent:0,userProgress:new Map},sync:{isOnline:typeof navigator<"u"?navigator.onLine:!0,lastSync:null,pendingChanges:[],isSyncing:!1},ui:{sidebarOpen:!0,currentView:"dashboard",theme:"light",notifications:[],hasErrors:!1,errorCount:0,lastError:null,lastErrorTime:null}};function R(){const{nodes:e,searchQuery:t}=r.content;if(!t.trim())return Array.from(e.values());const s=t.toLowerCase();return Array.from(e.values()).filter(n=>n.title.toLowerCase().includes(s)||n.metadata.tags.some(o=>o.toLowerCase().includes(s)))}function B(){const{completedModules:e,userProgress:t}=r.progress,s=r.content.nodes.size,n=s>0?e.size/s*100:0;let o=0;const u=Array.from(t.values());return u.length>0&&(o=u.reduce((l,h)=>l+(h.score||0),0)/u.length),{totalModules:s,completedModules:e.size,completionRate:n,averageScore:o,currentStreak:r.progress.currentStreak}}const N={setCurrentNode:e=>{r.content.currentNode=e},addKnowledgeNode:e=>{const t=new Map(r.content.nodes);t.set(e.id,e),r.content.nodes=t},updateKnowledgeNode:(e,t)=>{const s=r.content.nodes.get(e);if(s){const n=new Map(r.content.nodes);n.set(e,{...s,...t}),r.content.nodes=n}},removeKnowledgeNode:e=>{const t=new Map(r.content.nodes);t.delete(e),r.content.nodes=t;const s=new Set(r.progress.completedModules);s.delete(e),r.progress.completedModules=s;const n=new Map(r.progress.userProgress);n.delete(e),r.progress.userProgress=n},setSearchQuery:e=>{r.content.searchQuery=e},setSearchResults:e=>{r.content.searchResults=e},markModuleCompleted:(e,t)=>{const s=new Set(r.progress.completedModules);s.add(e),r.progress.completedModules=s;const n=r.progress.userProgress.get(e),o={userId:r.user.id,moduleId:e,status:"completed",score:t,timeSpent:n?.timeSpent||0,lastAccessed:new Date,attempts:(n?.attempts||0)+1,bookmarked:n?.bookmarked||!1,notes:n?.notes||"",completedAt:new Date},u=new Map(r.progress.userProgress);u.set(e,o),r.progress.userProgress=u},startModule:e=>{const t=r.progress.userProgress.get(e),s={userId:r.user.id,moduleId:e,status:"in-progress",timeSpent:t?.timeSpent||0,lastAccessed:new Date,attempts:t?.attempts||0,bookmarked:t?.bookmarked||!1,notes:t?.notes||"",startedAt:t?.startedAt||new Date},n=new Map(r.progress.userProgress);n.set(e,s),r.progress.userProgress=n},updateTimeSpent:(e,t)=>{const s=r.progress.userProgress.get(e);if(s){const n={...s,timeSpent:s.timeSpent+t,lastAccessed:new Date},o=new Map(r.progress.userProgress);o.set(e,n),r.progress.userProgress=o}},loadUserProgress:e=>{r.progress.userProgress=new Map(e);const t=new Set;for(const[s,n]of e)n.status==="completed"&&t.add(s);r.progress.completedModules=t,r.progress.totalTimeSpent=Array.from(e.values()).reduce((s,n)=>s+n.timeSpent,0)},updateUserProgress:(e,t)=>{const s=r.progress.userProgress.get(e);if(s){const n=new Map(r.progress.userProgress);n.set(e,{...s,...t}),r.progress.userProgress=n}},toggleSidebar:()=>{r.ui.sidebarOpen=!r.ui.sidebarOpen},setCurrentView:e=>{r.ui.currentView=e},addNotification:e=>{const t=crypto.randomUUID();r.ui.notifications.push({...e,id:t,timestamp:new Date})},removeNotification:e=>{const t=r.ui.notifications.findIndex(s=>s.id===e);t>-1&&r.ui.notifications.splice(t,1)},setOnlineStatus:e=>{r.sync.isOnline=e},addPendingChange:e=>{r.sync.pendingChanges.includes(e)||r.sync.pendingChanges.push(e)},removePendingChange:e=>{const t=r.sync.pendingChanges.indexOf(e);t>-1&&r.sync.pendingChanges.splice(t,1)},setSyncStatus:e=>{r.sync.isSyncing=e,e||(r.sync.lastSync=new Date)}};function K(e,t){A();let{nodes:s=[],showActions:n=!0,onNodeSelect:o,onNodeAdd:u,onNodeDelete:c,onNodeMove:l}=t,h=new Set,d=null;const p=()=>s.length>0?s:m(Array.from(r.content.nodes.values()));function m(i){const a=new Map,f=[];return i.forEach(g=>{a.set(g.id,{...g,children:[]})}),i.forEach(g=>{const b=a.get(g.id);if(g.parent){const y=a.get(g.parent);y?(y.children=y.children||[],y.children.push(b)):f.push(b)}else f.push(b)}),f}function w(i){return i.type==="folder"?h.has(i.id)?"📂":"📁":i.type==="module"?"📚":"📄"}function k(i,a,f){if(i.out.push(`<div${I("tree-node svelte-1oods8b",void 0,{current:r.content.currentNode?.id===a.id,"drop-target":d===a.id})}${E(`--depth: ${D(f)}`)}${P("draggable",n)}${P("role",n?"treeitem":"none")}${P("aria-label",n?`Draggable ${a.type}: ${a.title}`:void 0)}><div class="node-content svelte-1oods8b"><div class="node-main svelte-1oods8b">`),a.children&&a.children.length>0?(i.out.push("<!--[-->"),i.out.push(`<button class="expand-btn svelte-1oods8b"${P("aria-label",h.has(a.id)?"Collapse":"Expand")}>${v(h.has(a.id)?"▼":"▶")}</button>`)):(i.out.push("<!--[!-->"),i.out.push('<span class="expand-spacer svelte-1oods8b"></span>')),i.out.push(`<!--]--> <button class="node-btn svelte-1oods8b"${P("title",`${a.type}: ${a.title}`)}><span class="node-icon svelte-1oods8b">${v(w(a))}</span> <span class="node-title svelte-1oods8b">${v(a.title)}</span></button> `),a.progress?.completed?(i.out.push("<!--[-->"),i.out.push('<span class="completion-badge svelte-1oods8b" title="Completed">✅</span>')):i.out.push("<!--[!-->"),i.out.push("<!--]--></div> "),n?(i.out.push("<!--[-->"),i.out.push('<div class="node-actions svelte-1oods8b">'),a.type==="folder"?(i.out.push("<!--[-->"),i.out.push('<button class="action-btn svelte-1oods8b" title="Add Subfolder">📁+</button> <button class="action-btn svelte-1oods8b" title="Add Module">📚+</button>')):i.out.push("<!--[!-->"),i.out.push("<!--]--> "),a.type!=="folder"||!a.children||a.children.length===0?(i.out.push("<!--[-->"),i.out.push('<button class="action-btn svelte-1oods8b" title="Add Lesson">📄+</button>')):i.out.push("<!--[!-->"),i.out.push('<!--]--> <button class="action-btn delete-btn svelte-1oods8b" title="Delete Node">🗑️</button></div>')):i.out.push("<!--[!-->"),i.out.push(`<!--]--></div> <div class="node-meta svelte-1oods8b"><span class="difficulty svelte-1oods8b">Difficulty: ${v(a.metadata.difficulty)}/5</span> <span class="time svelte-1oods8b">~${v(a.metadata.estimatedTime)}min</span> `),a.metadata.tags.length>0?(i.out.push("<!--[-->"),i.out.push(`<span class="tags svelte-1oods8b">${v(a.metadata.tags.slice(0,2).join(", "))}</span>`)):i.out.push("<!--[!-->"),i.out.push("<!--]--></div></div> "),a.children&&a.children.length>0&&h.has(a.id)){i.out.push("<!--[-->");const g=q(a.children);i.out.push('<div class="children svelte-1oods8b"><!--[-->');for(let b=0,y=g.length;b<y;b++){let _=g[b];k(i,_,f+1)}i.out.push("<!--]--></div>")}else i.out.push("<!--[!-->");i.out.push("<!--]-->")}const S=q(p());e.out.push('<div class="knowledge-tree svelte-1oods8b"><div class="tree-header svelte-1oods8b"><h3 class="svelte-1oods8b">Knowledge Tree</h3> '),n?(e.out.push("<!--[-->"),e.out.push('<div class="tree-actions svelte-1oods8b"><button class="add-btn svelte-1oods8b" title="Add Root Folder">📁+</button> <button class="add-btn svelte-1oods8b" title="Add Root Module">📚+</button></div>')):e.out.push("<!--[!-->"),e.out.push('<!--]--></div> <div class="tree-content svelte-1oods8b"><!--[-->');for(let i=0,a=S.length;i<a;i++){let f=S[i];k(e,f,0)}e.out.push("<!--]--> "),p().length===0?(e.out.push("<!--[-->"),e.out.push('<div class="empty-state svelte-1oods8b"><p>No knowledge nodes yet.</p> '),n?(e.out.push("<!--[-->"),e.out.push('<button class="svelte-1oods8b">Create your first folder</button>')):e.out.push("<!--[!-->"),e.out.push("<!--]--></div>")):e.out.push("<!--[!-->"),e.out.push("<!--]--></div></div>"),x()}const M="InteractiveKnowledgeSystem",T=3,C={modules:{name:"modules",keyPath:"id",indexes:[{name:"title",keyPath:"title",unique:!1},{name:"author",keyPath:"metadata.author",unique:!1},{name:"tags",keyPath:"metadata.tags",unique:!1,multiEntry:!0},{name:"difficulty",keyPath:"metadata.difficulty",unique:!1},{name:"created",keyPath:"metadata.created",unique:!1}]},progress:{name:"progress",keyPath:["userId","moduleId"],indexes:[{name:"userId",keyPath:"userId",unique:!1},{name:"moduleId",keyPath:"moduleId",unique:!1},{name:"status",keyPath:"status",unique:!1},{name:"lastAccessed",keyPath:"lastAccessed",unique:!1}]},paths:{name:"paths",keyPath:"id",indexes:[{name:"name",keyPath:"name",unique:!1},{name:"difficulty",keyPath:"difficulty",unique:!1}]},settings:{name:"settings",keyPath:"id",indexes:[]},streaks:{name:"streaks",keyPath:"userId",indexes:[{name:"currentStreak",keyPath:"currentStreak",unique:!1},{name:"lastActivityDate",keyPath:"lastActivityDate",unique:!1}]},achievements:{name:"achievements",keyPath:"id",indexes:[{name:"userId",keyPath:"userId",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"earnedAt",keyPath:"earnedAt",unique:!1}]},links:{name:"links",keyPath:"id",indexes:[{name:"sourceId",keyPath:"sourceId",unique:!1},{name:"targetId",keyPath:"targetId",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"strength",keyPath:"strength",unique:!1},{name:"created",keyPath:"metadata.created",unique:!1},{name:"automatic",keyPath:"metadata.automatic",unique:!1}]},versions:{name:"versions",keyPath:"id",indexes:[{name:"entityType",keyPath:"entityType",unique:!1},{name:"entityId",keyPath:"entityId",unique:!1},{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"entityVersion",keyPath:["entityId","version"],unique:!0}]},offline_queue:{name:"offline_queue",keyPath:"id",indexes:[{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"entity",keyPath:"entity",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"priority",keyPath:"priority",unique:!1}]},sync_conflicts:{name:"sync_conflicts",keyPath:"id",indexes:[{name:"operationId",keyPath:"operationId",unique:!1},{name:"conflictType",keyPath:"conflictType",unique:!1},{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"resolved",keyPath:"resolved",unique:!1}]},web_sources:{name:"web_sources",keyPath:"id",indexes:[{name:"url",keyPath:"url",unique:!1},{name:"domain",keyPath:"domain",unique:!1},{name:"status",keyPath:"status",unique:!1},{name:"importDate",keyPath:"importDate",unique:!1},{name:"lastChecked",keyPath:"lastChecked",unique:!1},{name:"category",keyPath:"metadata.category",unique:!1},{name:"tags",keyPath:"metadata.tags",unique:!1,multiEntry:!0},{name:"author",keyPath:"metadata.author",unique:!1},{name:"timesReferenced",keyPath:"usage.timesReferenced",unique:!1}]}};class j{db=null;initPromise=null;get available(){return typeof window<"u"&&typeof window.indexedDB<"u"}async init(){return this.initPromise?this.initPromise:this.available?(this.initPromise=new Promise((t,s)=>{const n=setTimeout(()=>{s(new Error("Database initialization timeout"))},5e3),o=window.indexedDB.open(M,T);o.onerror=()=>{clearTimeout(n),s(new Error(`Failed to open database: ${o.error?.message}`))},o.onsuccess=()=>{clearTimeout(n),this.db=o.result,t()},o.onupgradeneeded=u=>{const c=u.target.result;this.createObjectStores(c)}}),this.initPromise):(this.initPromise=Promise.resolve(),this.initPromise)}createObjectStores(t){Object.values(C).forEach(s=>{if(!t.objectStoreNames.contains(s.name)){const n=t.createObjectStore(s.name,{keyPath:s.keyPath});s.indexes.forEach(o=>{const u=Array.isArray(o.keyPath)?[...o.keyPath]:o.keyPath,c={unique:o.unique};"multiEntry"in o&&(c.multiEntry=o.multiEntry||!1),n.createIndex(o.name,u,c)})}})}async ensureInitialized(){if(!this.available)throw new Error("IndexedDB is not available in this environment");if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async get(t,s){if(!this.available)return;const n=await this.ensureInitialized();return new Promise((o,u)=>{const h=n.transaction([t],"readonly").objectStore(t).get(s);h.onsuccess=()=>o(h.result),h.onerror=()=>u(h.error)})}async getAll(t,s,n){if(!this.available)return[];const o=await this.ensureInitialized();return new Promise((u,c)=>{const d=o.transaction([t],"readonly").objectStore(t).getAll(s,n);d.onsuccess=()=>u(d.result),d.onerror=()=>c(d.error)})}async add(t,s,n){if(!this.available)return;const o=await this.ensureInitialized();return new Promise((u,c)=>{const l=o.transaction([t,"versions"],"readwrite"),h=l.objectStore(t),d=l.objectStore("versions"),p=h.add(s);p.onsuccess=()=>{if(this.shouldVersion(t)){const m=this.createVersionRecord(t,s,n);d.add(m)}},l.oncomplete=()=>u(),l.onerror=()=>c(l.error)})}async put(t,s,n){if(!this.available)return;const o=await this.ensureInitialized();return new Promise((u,c)=>{const l=o.transaction([t,"versions"],"readwrite"),h=l.objectStore(t),d=l.objectStore("versions"),p=h.put(s);p.onsuccess=()=>{if(this.shouldVersion(t)){const m=this.createVersionRecord(t,s,n);d.add(m)}},l.oncomplete=()=>u(),l.onerror=()=>c(l.error)})}async delete(t,s){if(!this.available)return;const n=await this.ensureInitialized();return new Promise((o,u)=>{const c=n.transaction([t],"readwrite");c.objectStore(t).delete(s),c.oncomplete=()=>o(),c.onerror=()=>u(c.error)})}async searchByIndex(t,s,n,o){if(!this.available)return[];const u=await this.ensureInitialized();return new Promise((c,l)=>{const m=u.transaction([t],"readonly").objectStore(t).index(s).getAll(n,o);m.onsuccess=()=>c(m.result),m.onerror=()=>l(m.error)})}async getVersionHistory(t,s){if(!this.available)return[];const n=await this.ensureInitialized();return new Promise((o,u)=>{const d=n.transaction(["versions"],"readonly").objectStore("versions").index("entityId").getAll(t);d.onsuccess=()=>{const p=d.result.filter(m=>m.entityType===s);p.sort((m,w)=>w.timestamp.getTime()-m.timestamp.getTime()),o(p)},d.onerror=()=>u(d.error)})}async getVersion(t,s){if(!this.available)return;const n=await this.ensureInitialized();return new Promise((o,u)=>{const d=n.transaction(["versions"],"readonly").objectStore("versions").index("entityVersion").get([t,s]);d.onsuccess=()=>o(d.result),d.onerror=()=>u(d.error)})}shouldVersion(t){return["modules","paths","settings"].includes(t)}createVersionRecord(t,s,n){const o=this.getEntityId(s),u=this.getEntityVersion(s);return{id:`${o}_v${u}_${Date.now()}`,entityType:t==="modules"?"module":t==="paths"?"path":"settings",entityId:o,version:u,data:structuredClone(s),timestamp:new Date,changeDescription:n}}getEntityId(t){return t.id||t.userId||"unknown"}getEntityVersion(t){return t.metadata?.version||t.version||1}close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const L=new j;function Q(e,t){A(),e.out.push('<div class="progress-tracker bg-white border border-gray-200 rounded-lg p-4 svelte-w6vutz">'),e.out.push("<!--[!-->"),e.out.push("<!--]--> "),e.out.push("<!--[-->"),e.out.push('<div class="flex items-center justify-center py-4"><div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div> <span class="ml-2 text-sm text-gray-600">Loading progress...</span></div>'),e.out.push("<!--]--></div>"),x()}export{K,Q as P,N as a,r as b,R as c,B as g,L as s};
